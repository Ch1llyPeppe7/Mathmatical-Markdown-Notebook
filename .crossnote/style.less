/* =====================================================
   Global Tokens / Styles
===================================================== */
:root {
  /* Fonts - 中文楷体，英文 Times New Roman */
  --font-body: "KaiTi", "楷体", "STKaiti", "Times New Roman", "Times", serif;
  --font-size-body: 15.5px;
  --font-size-small: 14px;
  --font-size-tiny: 12px;
  --font-size-section: 13px;
  --font-size-chapter: 16px;
  --font-size-cover-title: 50px;
  --font-size-cover-subtitle: 25px;
  --font-size-cover-meta: 80px;
  --line-height-body: 1.5;
  
  /* Block Title Sizes - 块标题大小独立设置，大小关系：Chapter > # > section > ## > subsection > ### */
  --font-size-chapter-title: 22px;
  --font-size-block-title: 20px;
  --font-size-section-title: 18px;
  --font-size-subsection-title: 16px;
  
  /* Markdown Heading Sizes - Markdown 标题大小 */
  --font-size-h1: 19px;
  --font-size-h2: 17px;
  --font-size-h3: 15px;
  
  /* Cover Page Meta - 扉页元信息 */
  --font-size-cover-author: 16px;
  --font-size-cover-date: 16px;
  --font-size-cover-institution: 15px;

  /* Layout */
  --page-padding-v: 32px;
  --page-padding-h: 40px;
  --page-max-width: 100%;

  /* Colors - 全部使用深黑色 */
  --color-text-main: #000;
  --color-text-muted: #000;
  --color-bg-soft: #fafafa;
  --color-chapter-bg: #ffffff;
  --color-section-accent: #ffffff;
  --color-subsection-accent: #ffffff;
  --color-def: #2e7d32;
  --color-thm: #1565c0;
  --color-proof: #6a1b9a;
  --color-remark: #ef6c00;
  --color-example: #00695c;
  --color-property: #7b1fa2;
  --color-algorithm: #0288d1;
  --color-discussion: #666;
  --color-assumption: #9c27b0;
  --color-proposal: #009688;
  --color-lemma: #4caf50;
  --color-proposition: #00bcd4;
  --color-counterexample: #ff5722;
  --color-objective: #ff9800;
  --color-figure: #ffffff;
  --color-info: #3b82f6;
  --color-warning: #f91616;
  --color-tip: #10b981;
}
.toc-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.toc-list li {
  line-height: 1.8;
  position: relative;
  list-style: none;
}

.toc-list a {
  display: block;           /* 改成 block 方便 padding-left 生效 */
  text-decoration: none;
  color: black;
  white-space: nowrap;
}

.toc-title {
  display: inline-block;
}

.toc-leader {
  border-bottom: 1px dotted #999;
  flex-grow: 1;
  display: inline-block;
  width: 100%;
  margin-left: 0.5em;
}

/* 缩进 */
.toc-h1 a { padding-left: 0em; }
.toc-h2 a { padding-left: 2em; }
.toc-h3 a { padding-left: 4em; }


/* =====================================================
   Print Color Adjustment (Prince 打印时保留背景色)
===================================================== */
@media print {
  * {
    print-color-adjust: exact !important;
    -webkit-print-color-adjust: exact !important;
    -prince-color-adjust: exact !important;
    color-adjust: exact !important;
  }
}

/* =====================================================
   Global Layout
===================================================== */
.markdown-preview {
  font-family: var(--font-body);
  font-size: var(--font-size-body);
  line-height: var(--line-height-body);
  color: #000 !important;
  font-weight: 400;
  padding: var(--page-padding-v) var(--page-padding-h);
  max-width: var(--page-max-width);
  margin: 0;
  width: 100%;
  box-sizing: border-box;
}

/* 确保所有文本都是深黑色 */
.markdown-preview,
.markdown-preview * {
  color: #000 !important;
}

/* 普通段落文本粗细和数学公式一致（normal weight） */
.markdown-preview p,
.markdown-preview li,
.markdown-preview td,
.markdown-preview th,
.markdown-preview blockquote:not([class]) {
  font-weight: 400;
}

/* 确保加粗文本（** **）更明显 */
.markdown-preview strong,
.markdown-preview b {
  font-weight: 700 !important;
}

/* =====================================================
   Cover Page / 扉页 - LaTeX 论文风格
===================================================== */
.markdown-preview blockquote.cover-page {
  min-height: 45vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  page-break-after: always;
  margin: 0;
  padding: 80px 60px;
  border: none;
  background: white !important;
  position: relative;
}

.markdown-preview blockquote.cover-page::before {
  content: none;
}

.markdown-preview blockquote.cover-page > blockquote.cover-title,
.markdown-preview blockquote.cover-page > .cover-title,
.markdown-preview blockquote.cover-page > :first-child:not(blockquote):not(.cover-meta-container):not(.cover-meta-group) {
  font-size: var(--font-size-cover-title);
  font-weight: 700;
  font-family: var(--font-body);
  color: #000 !important;
  margin: 0 0 20px 0;
  padding: 0;
  line-height: 1.4;
  letter-spacing: 1px;
  border: none;
}

.markdown-preview blockquote.cover-page blockquote.cover-subtitle {
  font-size: var(--font-size-cover-subtitle);
  font-weight: 300;
  font-style: normal;
  color: #000 !important;
  margin: 0 0 60px 0;
  padding: 0;
  line-height: 1.6;
  border: none;
  border-left: none;
  letter-spacing: 0.5px;
  background-color: white !important;
}

.markdown-preview blockquote.cover-page blockquote.cover-subtitle::before {
  content: none;
}

/* 扉页元信息拆解 - 作者、日期、机构等 */
.markdown-preview blockquote.cover-page blockquote.cover-author,
.markdown-preview blockquote.cover-page .cover-author {
  font-size: var(--font-size-cover-author);
  font-weight: 400;
  font-style: normal;
  color: #000 !important;
  margin: 8px 0;
  padding: 0;
  line-height: 1.8;
  border: none;
  border-left: none;
  letter-spacing: 0.5px;
}

.markdown-preview blockquote.cover-page blockquote.cover-author::before {
  content: none;
}

.markdown-preview blockquote.cover-page blockquote.cover-date,
.markdown-preview blockquote.cover-page .cover-date {
  font-size: var(--font-size-cover-date);
  font-weight: 400;
  font-style: normal;
  color: #000 !important;
  margin: 8px 0;
  padding: 0;
  line-height: 1.8;
  border: none;
  border-left: none;
  letter-spacing: 0.5px;
}

.markdown-preview blockquote.cover-page blockquote.cover-date::before {
  content: none;
}

.markdown-preview blockquote.cover-page blockquote.cover-institution,
.markdown-preview blockquote.cover-page .cover-institution {
  font-size: var(--font-size-cover-institution);
  font-weight: 300;
  font-style: normal;
  color: #000 !important;
  margin: 8px 0;
  padding: 0;
  line-height: 1.8;
  border: none;
  border-left: none;
  letter-spacing: 0.3px;
}

.markdown-preview blockquote.cover-page blockquote.cover-institution::before {
  content: none;
}

/* 兼容旧的 cover-meta 格式 */
.markdown-preview blockquote.cover-page blockquote.cover-meta {
  font-size: var(--font-size-cover-meta);
  font-weight: 400;
  font-style: normal;
  color: #000 !important;
  margin: 0;
  padding: 0;
  line-height: 1.8;
  border: none;
  border-left: none;
  letter-spacing: 0.3px;
}

.markdown-preview blockquote.cover-page blockquote.cover-meta::before {
  content: none;
}

/* 扉页元信息容器布局 - 美化排版 */
.markdown-preview blockquote.cover-page .cover-meta-container {
  display: block;
  font-size: var(--font-size-cover-author);
  font-weight: 400;
  color: #000 !important;
  margin: 6px 0;
  padding: 0;
  line-height: 1.8;
  letter-spacing: 0.5px;
  border: none;
}

.markdown-preview blockquote.cover-page .cover-meta-container::before {
  content: none;
}

/* 扉页元信息区域整体布局 */
.markdown-preview blockquote.cover-page .cover-meta-group {
  margin-top: 50px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

/* 扉页底部装饰线（可选） */
.markdown-preview blockquote.cover-page::after {
  content: "";
  position: absolute;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%);
  width: 80px;
  height: 1px;
  background-color: #999;
  opacity: 0.4;
}

/* =====================================================
   Chapter / Section / Subsection
===================================================== */
.markdown-preview blockquote.chapter {
  counter-reset:
    section-counter
    subsection-counter
    def-counter
    thm-counter
    example-counter
    remark-counter
    property-counter
    algorithm-counter
    discussion-counter
    assumption-counter
    proposal-counter
    lemma-counter
    proposition-counter
    counterexample-counter
    objective-counter
    figure-counter;

  counter-increment: chapter-counter;
  font-size: var(--font-size-chapter);
  font-weight: 700;
  text-align: left;
  margin: 48px 0 24px 0;
  padding: 28px 24px;
  background-color: var(--color-chapter-bg);
  border-radius: 6px;
  page-break-before: always;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}

.markdown-preview blockquote.chapter::before {
  content: "Chapter " counter(chapter-counter);
  display: block;
  font-weight: 700;
  font-size: var(--font-size-chapter-title);
  margin-bottom: 6px;
  text-align: left;
  color: #000 !important;
}

/* =====================================================
   Appendix / Appendix Section
===================================================== */
.markdown-preview blockquote.appendix {
  counter-reset:
    appendix-section-counter
    subsection-counter
    def-counter
    thm-counter
    example-counter
    remark-counter
    property-counter
    algorithm-counter
    discussion-counter
    assumption-counter
    proposal-counter
    lemma-counter
    proposition-counter
    counterexample-counter
    objective-counter
    figure-counter;

  counter-increment: appendix-counter;
  font-size: var(--font-size-chapter);
  font-weight: 700;
  text-align: left;
  margin: 48px 0 24px 0;
  padding: 28px 24px;
  background-color: var(--color-chapter-bg);
  border: none;
  border-radius: 6px;
  page-break-before: always;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}

.markdown-preview blockquote.appendix::before {
  content: "Appendix " counter(appendix-counter, upper-alpha);
  display: block;
  font-weight: 700;
  font-size: var(--font-size-chapter-title);
  margin-bottom: 6px;
  text-align: left;
  color: #000 !important;
}

/* =====================================================
   Preface - 前言，与chapter同级别但独立计数
===================================================== */
.markdown-preview blockquote.preface {
  counter-reset:
    preface-section-counter
    subsection-counter
    def-counter
    thm-counter
    example-counter
    remark-counter
    property-counter
    algorithm-counter
    discussion-counter
    assumption-counter
    proposal-counter
    lemma-counter
    proposition-counter
    counterexample-counter
    objective-counter
    figure-counter;

  counter-increment: preface-counter;
  font-size: var(--font-size-chapter);
  font-weight: 700;
  text-align: left;
  margin: 48px 0 24px 0;
  padding: 28px 24px;
  background-color: var(--color-chapter-bg);
  border: none;
  border-radius: 6px;
  page-break-before: always;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}

.markdown-preview blockquote.preface::before {
  content: "Preface";
  display: block;
  font-weight: 700;
  font-size: var(--font-size-chapter-title);
  margin-bottom: 6px;
  text-align: left;
  color: #000 !important;
}

/* Preface Section - 前言子块，使用preface独立的计数器 */
.markdown-preview blockquote.preface-section {
  counter-reset: 
    subsection-counter
    def-counter
    thm-counter
    example-counter
    remark-counter
    property-counter
    algorithm-counter
    discussion-counter
    assumption-counter
    proposal-counter
    lemma-counter
    proposition-counter
    counterexample-counter
    objective-counter
    figure-counter;
  counter-increment: preface-section-counter;
  font-size: var(--font-size-body);
  font-weight: 700;
  margin: 32px 0 14px 0;
  padding: 12px 20px;
  border: none;
  background-color: #ffffff;
  border-radius: 5px;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}

.markdown-preview blockquote.preface-section::before {
  content: "Section " counter(preface-section-counter);
  display: block;
  font-weight: 700;
  font-size: var(--font-size-section-title);
  margin-bottom: 6px;
  text-align: left;
  color: #000 !important;
}

.markdown-preview blockquote.section {
  counter-reset: 
    subsection-counter
    def-counter
    thm-counter
    example-counter
    remark-counter
    property-counter
    algorithm-counter
    discussion-counter
    assumption-counter
    proposal-counter
    lemma-counter
    proposition-counter
    counterexample-counter
    objective-counter
    figure-counter;
  counter-increment: section-counter;
  font-size: var(--font-size-body);
  font-weight: 700;
  margin: 32px 0 14px 0;
  padding: 12px 20px;
  border-left: 4px solid var(--color-section-accent);
  background-color: #ffffff;
  border-radius: 5px;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}

.markdown-preview blockquote.section::before {
  content: "Section " counter(chapter-counter) "." counter(section-counter);
  display: block;
  font-weight: 700;
  font-size: var(--font-size-section-title);
  margin-bottom: 6px;
  text-align: left;
  color: #000 !important;
}

/* Appendix Section - 附录子块，使用appendix独立的计数器 */
.markdown-preview blockquote.appendix-section {
  counter-reset: 
    subsection-counter
    def-counter
    thm-counter
    example-counter
    remark-counter
    property-counter
    algorithm-counter
    discussion-counter
    assumption-counter
    proposal-counter
    lemma-counter
    proposition-counter
    counterexample-counter
    objective-counter
    figure-counter;
  counter-increment: appendix-section-counter;
  font-size: var(--font-size-body);
  font-weight: 700;
  margin: 32px 0 14px 0;
  padding: 12px 20px;
  border: none;
  background-color: #ffffff;
  border-radius: 5px;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}

.markdown-preview blockquote.appendix-section::before {
  content: "Appendix " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter);
  display: block;
  font-weight: 700;
  font-size: var(--font-size-section-title);
  margin-bottom: 6px;
  text-align: left;
  color: #000 !important;
}

.markdown-preview blockquote.subsection {
  counter-reset:
    def-counter
    thm-counter
    example-counter
    remark-counter
    property-counter
    algorithm-counter
    discussion-counter
    assumption-counter
    proposal-counter
    lemma-counter
    proposition-counter
    counterexample-counter
    objective-counter
    figure-counter;
  counter-increment: subsection-counter;
  font-size: var(--font-size-body);
  font-weight: 600;
  margin: 24px 0 10px 0;
  padding: 10px 18px;
  border-left: 3px solid var(--color-subsection-accent);
  background-color: #ffffff;
  border-radius: 5px;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}

.markdown-preview blockquote.subsection::before {
  content: "Subsection " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter);
  display: block;
  font-weight: 600;
  font-size: var(--font-size-subsection-title);
  margin-bottom: 6px;
  text-align: left;
  color: #000 !important;
}

/* Appendix Section 内的 Subsection */
.markdown-preview blockquote.appendix-section blockquote.subsection::before {
  content: "Subsection " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter);
}

/* Preface Section 内的 Subsection */
.markdown-preview blockquote.preface-section blockquote.subsection::before {
  content: "Subsection " counter(preface-section-counter) "." counter(subsection-counter);
}

/* =====================================================
   Math Blocks
===================================================== */
.markdown-preview blockquote.math-block {
  margin: 18px 0;
  padding: 10px 14px;
  font-size: var(--font-size-body);
  border-left: 4px solid #666;
  border-radius: 5px;
  background-color: #f6f6f6;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}

/* Counter Increment */
.markdown-preview blockquote.definition { counter-increment: def-counter; }
.markdown-preview blockquote.theorem { counter-increment: thm-counter; }
.markdown-preview blockquote.example { counter-increment: example-counter; }
.markdown-preview blockquote.remark { counter-increment: remark-counter; }
.markdown-preview blockquote.property { counter-increment: property-counter; }
.markdown-preview blockquote.algorithm { counter-increment: algorithm-counter; }
.markdown-preview blockquote.discussion { counter-increment: discussion-counter; }
.markdown-preview blockquote.assumption { counter-increment: assumption-counter; }
.markdown-preview blockquote.proposal { counter-increment: proposal-counter; }
.markdown-preview blockquote.lemma { counter-increment: lemma-counter; }
.markdown-preview blockquote.proposition { counter-increment: proposition-counter; }
.markdown-preview blockquote.counterexample { counter-increment: counterexample-counter; }
.markdown-preview blockquote.objective { counter-increment: objective-counter; }
.markdown-preview blockquote.figure { counter-increment: figure-counter; }

/* Auto Titles - 根据所在层级自适应编号 */
/* 在subsection内的块：使用subsection编号 */
.markdown-preview blockquote.subsection blockquote.definition::before {
  content: "Definition " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(def-counter);
}
.markdown-preview blockquote.subsection blockquote.theorem::before {
  content: "Theorem " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(thm-counter);
}
.markdown-preview blockquote.subsection blockquote.example::before {
  content: "Example " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(example-counter);
}
.markdown-preview blockquote.subsection blockquote.remark::before {
  content: "Remark " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(remark-counter);
}
.markdown-preview blockquote.subsection blockquote.property::before {
  content: "Property " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(property-counter);
}
.markdown-preview blockquote.subsection blockquote.algorithm::before {
  content: "Algorithm " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(algorithm-counter);
}
.markdown-preview blockquote.subsection blockquote.discussion::before {
  content: "Discussion " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(discussion-counter);
}
.markdown-preview blockquote.subsection blockquote.assumption::before {
  content: "Assumption " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(assumption-counter);
}
.markdown-preview blockquote.subsection blockquote.proposal::before {
  content: "Proposal " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(proposal-counter);
}
.markdown-preview blockquote.subsection blockquote.lemma::before {
  content: "Lemma " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(lemma-counter);
}
.markdown-preview blockquote.subsection blockquote.proposition::before {
  content: "Proposition " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(proposition-counter);
}
.markdown-preview blockquote.subsection blockquote.counterexample::before {
  content: "Counterexample " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(counterexample-counter);
}
.markdown-preview blockquote.subsection blockquote.objective::before {
  content: "Objective " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(objective-counter);
}
.markdown-preview blockquote.subsection blockquote.figure::before {
  content: "Figure " counter(chapter-counter) "." counter(section-counter) "." counter(subsection-counter) "." counter(figure-counter);
}

/* 在section内的块（但不在subsection内）：使用section编号 */
.markdown-preview blockquote.section > blockquote.definition::before {
  content: "Definition " counter(chapter-counter) "." counter(section-counter) "." counter(def-counter);
}
.markdown-preview blockquote.section > blockquote.theorem::before {
  content: "Theorem " counter(chapter-counter) "." counter(section-counter) "." counter(thm-counter);
}
.markdown-preview blockquote.section > blockquote.example::before {
  content: "Example " counter(chapter-counter) "." counter(section-counter) "." counter(example-counter);
}
.markdown-preview blockquote.section > blockquote.remark::before {
  content: "Remark " counter(chapter-counter) "." counter(section-counter) "." counter(remark-counter);
}
.markdown-preview blockquote.section > blockquote.property::before {
  content: "Property " counter(chapter-counter) "." counter(section-counter) "." counter(property-counter);
}
.markdown-preview blockquote.section > blockquote.algorithm::before {
  content: "Algorithm " counter(chapter-counter) "." counter(section-counter) "." counter(algorithm-counter);
}
.markdown-preview blockquote.section > blockquote.discussion::before {
  content: "Discussion " counter(chapter-counter) "." counter(section-counter) "." counter(discussion-counter);
}
.markdown-preview blockquote.section > blockquote.assumption::before {
  content: "Assumption " counter(chapter-counter) "." counter(section-counter) "." counter(assumption-counter);
}
.markdown-preview blockquote.section > blockquote.proposal::before {
  content: "Proposal " counter(chapter-counter) "." counter(section-counter) "." counter(proposal-counter);
}
.markdown-preview blockquote.section > blockquote.lemma::before {
  content: "Lemma " counter(chapter-counter) "." counter(section-counter) "." counter(lemma-counter);
}
.markdown-preview blockquote.section > blockquote.proposition::before {
  content: "Proposition " counter(chapter-counter) "." counter(section-counter) "." counter(proposition-counter);
}
.markdown-preview blockquote.section > blockquote.counterexample::before {
  content: "Counterexample " counter(chapter-counter) "." counter(section-counter) "." counter(counterexample-counter);
}
.markdown-preview blockquote.section > blockquote.objective::before {
  content: "Objective " counter(chapter-counter) "." counter(section-counter) "." counter(objective-counter);
}
.markdown-preview blockquote.section > blockquote.figure::before {
  content: "Figure " counter(chapter-counter) "." counter(section-counter) "." counter(figure-counter);
}

/* 在chapter内的块（但不在section内）：使用chapter编号（默认情况） */
.markdown-preview blockquote.chapter > blockquote.definition::before {
  content: "Definition " counter(chapter-counter) "." counter(def-counter);
}
.markdown-preview blockquote.chapter > blockquote.theorem::before {
  content: "Theorem " counter(chapter-counter) "." counter(thm-counter);
}
.markdown-preview blockquote.chapter > blockquote.example::before {
  content: "Example " counter(chapter-counter) "." counter(example-counter);
}
.markdown-preview blockquote.chapter > blockquote.remark::before {
  content: "Remark " counter(chapter-counter) "." counter(remark-counter);
}
.markdown-preview blockquote.chapter > blockquote.property::before {
  content: "Property " counter(chapter-counter) "." counter(property-counter);
}
.markdown-preview blockquote.chapter > blockquote.algorithm::before {
  content: "Algorithm " counter(chapter-counter) "." counter(algorithm-counter);
}
.markdown-preview blockquote.chapter > blockquote.discussion::before {
  content: "Discussion " counter(chapter-counter) "." counter(discussion-counter);
}
.markdown-preview blockquote.chapter > blockquote.assumption::before {
  content: "Assumption " counter(chapter-counter) "." counter(assumption-counter);
}
.markdown-preview blockquote.chapter > blockquote.proposal::before {
  content: "Proposal " counter(chapter-counter) "." counter(proposal-counter);
}
.markdown-preview blockquote.chapter > blockquote.lemma::before {
  content: "Lemma " counter(chapter-counter) "." counter(lemma-counter);
}
.markdown-preview blockquote.chapter > blockquote.proposition::before {
  content: "Proposition " counter(chapter-counter) "." counter(proposition-counter);
}
.markdown-preview blockquote.chapter > blockquote.counterexample::before {
  content: "Counterexample " counter(chapter-counter) "." counter(counterexample-counter);
}
.markdown-preview blockquote.chapter > blockquote.objective::before {
  content: "Objective " counter(chapter-counter) "." counter(objective-counter);
}
.markdown-preview blockquote.chapter > blockquote.figure::before {
  content: "Figure " counter(chapter-counter) "." counter(figure-counter);
}

/* 在appendix-section内的块（但不在subsection内）：使用appendix-section编号 */
.markdown-preview blockquote.appendix-section > blockquote.definition::before {
  content: "Definition " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(def-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.theorem::before {
  content: "Theorem " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(thm-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.example::before {
  content: "Example " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(example-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.remark::before {
  content: "Remark " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(remark-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.property::before {
  content: "Property " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(property-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.algorithm::before {
  content: "Algorithm " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(algorithm-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.discussion::before {
  content: "Discussion " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(discussion-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.assumption::before {
  content: "Assumption " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(assumption-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.proposal::before {
  content: "Proposal " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(proposal-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.lemma::before {
  content: "Lemma " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(lemma-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.proposition::before {
  content: "Proposition " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(proposition-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.counterexample::before {
  content: "Counterexample " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(counterexample-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.objective::before {
  content: "Objective " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(objective-counter);
}
.markdown-preview blockquote.appendix-section > blockquote.figure::before {
  content: "Figure " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(figure-counter);
}

/* 在appendix-section内的subsection内的块：使用appendix-subsection编号 */
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.definition::before {
  content: "Definition " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(def-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.theorem::before {
  content: "Theorem " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(thm-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.example::before {
  content: "Example " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(example-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.remark::before {
  content: "Remark " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(remark-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.property::before {
  content: "Property " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(property-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.algorithm::before {
  content: "Algorithm " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(algorithm-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.discussion::before {
  content: "Discussion " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(discussion-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.assumption::before {
  content: "Assumption " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(assumption-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.proposal::before {
  content: "Proposal " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(proposal-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.lemma::before {
  content: "Lemma " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(lemma-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.proposition::before {
  content: "Proposition " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(proposition-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.counterexample::before {
  content: "Counterexample " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(counterexample-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.objective::before {
  content: "Objective " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(objective-counter);
}
.markdown-preview blockquote.appendix-section blockquote.subsection blockquote.figure::before {
  content: "Figure " counter(appendix-counter, upper-alpha) "." counter(appendix-section-counter) "." counter(subsection-counter) "." counter(figure-counter);
}

/* 在appendix内的块（但不在appendix-section内）：使用appendix编号 */
.markdown-preview blockquote.appendix > blockquote.definition::before {
  content: "Definition " counter(appendix-counter, upper-alpha) "." counter(def-counter);
}
.markdown-preview blockquote.appendix > blockquote.theorem::before {
  content: "Theorem " counter(appendix-counter, upper-alpha) "." counter(thm-counter);
}
.markdown-preview blockquote.appendix > blockquote.example::before {
  content: "Example " counter(appendix-counter, upper-alpha) "." counter(example-counter);
}
.markdown-preview blockquote.appendix > blockquote.remark::before {
  content: "Remark " counter(appendix-counter, upper-alpha) "." counter(remark-counter);
}
.markdown-preview blockquote.appendix > blockquote.property::before {
  content: "Property " counter(appendix-counter, upper-alpha) "." counter(property-counter);
}
.markdown-preview blockquote.appendix > blockquote.algorithm::before {
  content: "Algorithm " counter(appendix-counter, upper-alpha) "." counter(algorithm-counter);
}
.markdown-preview blockquote.appendix > blockquote.discussion::before {
  content: "Discussion " counter(appendix-counter, upper-alpha) "." counter(discussion-counter);
}
.markdown-preview blockquote.appendix > blockquote.assumption::before {
  content: "Assumption " counter(appendix-counter, upper-alpha) "." counter(assumption-counter);
}
.markdown-preview blockquote.appendix > blockquote.proposal::before {
  content: "Proposal " counter(appendix-counter, upper-alpha) "." counter(proposal-counter);
}
.markdown-preview blockquote.appendix > blockquote.lemma::before {
  content: "Lemma " counter(appendix-counter, upper-alpha) "." counter(lemma-counter);
}
.markdown-preview blockquote.appendix > blockquote.proposition::before {
  content: "Proposition " counter(appendix-counter, upper-alpha) "." counter(proposition-counter);
}
.markdown-preview blockquote.appendix > blockquote.counterexample::before {
  content: "Counterexample " counter(appendix-counter, upper-alpha) "." counter(counterexample-counter);
}
.markdown-preview blockquote.appendix > blockquote.objective::before {
  content: "Objective " counter(appendix-counter, upper-alpha) "." counter(objective-counter);
}
.markdown-preview blockquote.appendix > blockquote.figure::before {
  content: "Figure " counter(appendix-counter, upper-alpha) "." counter(figure-counter);
}

/* 在preface-section内的块（但不在subsection内）：使用preface-section编号 */
.markdown-preview blockquote.preface-section > blockquote.definition::before {
  content: "Definition " counter(preface-section-counter) "." counter(def-counter);
}
.markdown-preview blockquote.preface-section > blockquote.theorem::before {
  content: "Theorem " counter(preface-section-counter) "." counter(thm-counter);
}
.markdown-preview blockquote.preface-section > blockquote.example::before {
  content: "Example " counter(preface-section-counter) "." counter(example-counter);
}
.markdown-preview blockquote.preface-section > blockquote.remark::before {
  content: "Remark " counter(preface-section-counter) "." counter(remark-counter);
}
.markdown-preview blockquote.preface-section > blockquote.property::before {
  content: "Property " counter(preface-section-counter) "." counter(property-counter);
}
.markdown-preview blockquote.preface-section > blockquote.algorithm::before {
  content: "Algorithm " counter(preface-section-counter) "." counter(algorithm-counter);
}
.markdown-preview blockquote.preface-section > blockquote.discussion::before {
  content: "Discussion " counter(preface-section-counter) "." counter(discussion-counter);
}
.markdown-preview blockquote.preface-section > blockquote.assumption::before {
  content: "Assumption " counter(preface-section-counter) "." counter(assumption-counter);
}
.markdown-preview blockquote.preface-section > blockquote.proposal::before {
  content: "Proposal " counter(preface-section-counter) "." counter(proposal-counter);
}
.markdown-preview blockquote.preface-section > blockquote.lemma::before {
  content: "Lemma " counter(preface-section-counter) "." counter(lemma-counter);
}
.markdown-preview blockquote.preface-section > blockquote.proposition::before {
  content: "Proposition " counter(preface-section-counter) "." counter(proposition-counter);
}
.markdown-preview blockquote.preface-section > blockquote.counterexample::before {
  content: "Counterexample " counter(preface-section-counter) "." counter(counterexample-counter);
}
.markdown-preview blockquote.preface-section > blockquote.objective::before {
  content: "Objective " counter(preface-section-counter) "." counter(objective-counter);
}
.markdown-preview blockquote.preface-section > blockquote.figure::before {
  content: "Figure " counter(preface-section-counter) "." counter(figure-counter);
}

/* 在preface-section内的subsection内的块：使用preface-subsection编号 */
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.definition::before {
  content: "Definition " counter(preface-section-counter) "." counter(subsection-counter) "." counter(def-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.theorem::before {
  content: "Theorem " counter(preface-section-counter) "." counter(subsection-counter) "." counter(thm-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.example::before {
  content: "Example " counter(preface-section-counter) "." counter(subsection-counter) "." counter(example-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.remark::before {
  content: "Remark " counter(preface-section-counter) "." counter(subsection-counter) "." counter(remark-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.property::before {
  content: "Property " counter(preface-section-counter) "." counter(subsection-counter) "." counter(property-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.algorithm::before {
  content: "Algorithm " counter(preface-section-counter) "." counter(subsection-counter) "." counter(algorithm-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.discussion::before {
  content: "Discussion " counter(preface-section-counter) "." counter(subsection-counter) "." counter(discussion-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.assumption::before {
  content: "Assumption " counter(preface-section-counter) "." counter(subsection-counter) "." counter(assumption-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.proposal::before {
  content: "Proposal " counter(preface-section-counter) "." counter(subsection-counter) "." counter(proposal-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.lemma::before {
  content: "Lemma " counter(preface-section-counter) "." counter(subsection-counter) "." counter(lemma-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.proposition::before {
  content: "Proposition " counter(preface-section-counter) "." counter(subsection-counter) "." counter(proposition-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.counterexample::before {
  content: "Counterexample " counter(preface-section-counter) "." counter(subsection-counter) "." counter(counterexample-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.objective::before {
  content: "Objective " counter(preface-section-counter) "." counter(subsection-counter) "." counter(objective-counter);
}
.markdown-preview blockquote.preface-section blockquote.subsection blockquote.figure::before {
  content: "Figure " counter(preface-section-counter) "." counter(subsection-counter) "." counter(figure-counter);
}

/* 在preface内的块（但不在preface-section内）：使用preface编号 */
.markdown-preview blockquote.preface > blockquote.definition::before {
  content: "Definition " counter(def-counter);
}
.markdown-preview blockquote.preface > blockquote.theorem::before {
  content: "Theorem " counter(thm-counter);
}
.markdown-preview blockquote.preface > blockquote.example::before {
  content: "Example " counter(example-counter);
}
.markdown-preview blockquote.preface > blockquote.remark::before {
  content: "Remark " counter(remark-counter);
}
.markdown-preview blockquote.preface > blockquote.property::before {
  content: "Property " counter(property-counter);
}
.markdown-preview blockquote.preface > blockquote.algorithm::before {
  content: "Algorithm " counter(algorithm-counter);
}
.markdown-preview blockquote.preface > blockquote.discussion::before {
  content: "Discussion " counter(discussion-counter);
}
.markdown-preview blockquote.preface > blockquote.assumption::before {
  content: "Assumption " counter(assumption-counter);
}
.markdown-preview blockquote.preface > blockquote.proposal::before {
  content: "Proposal " counter(proposal-counter);
}
.markdown-preview blockquote.preface > blockquote.lemma::before {
  content: "Lemma " counter(lemma-counter);
}
.markdown-preview blockquote.preface > blockquote.proposition::before {
  content: "Proposition " counter(proposition-counter);
}
.markdown-preview blockquote.preface > blockquote.counterexample::before {
  content: "Counterexample " counter(counterexample-counter);
}
.markdown-preview blockquote.preface > blockquote.objective::before {
  content: "Objective " counter(objective-counter);
}
.markdown-preview blockquote.preface > blockquote.figure::before {
  content: "Figure " counter(figure-counter);
}

.markdown-preview blockquote.proof::before { content: "Proof."; }

/* Title Style - 自动添加的标题字体更大，独立设置大小 */
.markdown-preview blockquote.definition::before,
.markdown-preview blockquote.theorem::before,
.markdown-preview blockquote.example::before,
.markdown-preview blockquote.remark::before,
.markdown-preview blockquote.property::before,
.markdown-preview blockquote.algorithm::before,
.markdown-preview blockquote.discussion::before,
.markdown-preview blockquote.assumption::before,
.markdown-preview blockquote.proposal::before,
.markdown-preview blockquote.lemma::before,
.markdown-preview blockquote.proposition::before,
.markdown-preview blockquote.counterexample::before,
.markdown-preview blockquote.objective::before,
.markdown-preview blockquote.figure::before,
.markdown-preview blockquote.proof::before {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  font-size: var(--font-size-block-title);
  color: #000 !important;
  text-align: left;
}

/* 块内字体统一为全局字体大小 */
.markdown-preview blockquote.definition,
.markdown-preview blockquote.theorem,
.markdown-preview blockquote.proof,
.markdown-preview blockquote.remark,
.markdown-preview blockquote.property,
.markdown-preview blockquote.algorithm,
.markdown-preview blockquote.discussion,
.markdown-preview blockquote.assumption,
.markdown-preview blockquote.proposal,
.markdown-preview blockquote.lemma,
.markdown-preview blockquote.proposition,
.markdown-preview blockquote.counterexample,
.markdown-preview blockquote.objective,
.markdown-preview blockquote.figure {
  font-size: var(--font-size-body);
}

/* Colors - 增强底色可见度，Prince 打印支持（直接使用颜色值，不使用 color-mix） */
.markdown-preview blockquote.definition { 
  border-color: var(--color-def); 
  background-color: #edfaee;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.theorem { 
  border-color: var(--color-thm); 
  background-color: #eaf2fc;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.proof { 
  border-color: var(--color-proof); 
  background-color: #f5edfa;
  font-style: italic;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.remark { 
  border-color: var(--color-remark); 
  background-color: #fff8ef;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.example { 
  border-color: var(--color-example); 
  background-color: #d9f8f4;
  font-size: var(--font-size-body);
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.property { 
  border-color: var(--color-property); 
  background-color: #f3e5f5;
  font-size: var(--font-size-body);
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.algorithm { 
  border-color: var(--color-algorithm); 
  background-color: #e1f5fe;
  font-size: var(--font-size-body);
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.discussion { 
  border-color: var(--color-discussion); 
  background-color: #f5f5f5;
  font-size: var(--font-size-body);
  color: #000 !important;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}

.markdown-preview blockquote.discussion * {
  color: #000 !important;
}
.markdown-preview blockquote.assumption { 
  border-color: var(--color-assumption); 
  background-color: #f3e5f5;
  font-size: var(--font-size-body);
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.proposal { 
  border-color: var(--color-proposal); 
  background-color: #e0f2f1;
  font-size: var(--font-size-body);
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.lemma { 
  border-color: var(--color-lemma); 
  background-color: #e8f5e9;
  font-size: var(--font-size-body);
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.proposition { 
  border-color: var(--color-proposition); 
  background-color: #e0f7fa;
  font-size: var(--font-size-body);
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.counterexample { 
  border-color: var(--color-counterexample); 
  background-color: #ffebee;
  font-size: var(--font-size-body);
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.objective { 
  border-color: var(--color-objective); 
  background-color: #fff3e0;
  font-size: var(--font-size-body);
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.figure { 
  background: linear-gradient(to bottom, #fafbfc 0%, #f5f7f9 100%);
  font-size: var(--font-size-body);
  margin: 16px 0;
  padding: 20px 24px;
  border: none;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06), 0 1px 3px rgba(0, 0, 0, 0.04);
  transition: box-shadow 0.2s ease;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}

/* Figure 块标题样式优化 */
.markdown-preview blockquote.figure::before {
  display: block;
  margin-bottom: 12px;
  font-weight: 600;
  font-size: var(--font-size-block-title);
  color: #374151 !important;
  text-align: center;
  letter-spacing: 0.5px;
}

/* Figure 块内的图片自适应布局 - 美化 */
.markdown-preview blockquote.figure img {
  max-width: 100%;
  height: auto;
  display: block;
  margin: 12px auto;
  border-radius: 6px;
  box-sizing: border-box;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.markdown-preview blockquote.figure img:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 3px 6px rgba(0, 0, 0, 0.08);
}

.markdown-preview blockquote.figure p {
  margin: 8px 0 4px 0;
  text-align: center;
  color: #6b7280;
  font-size: var(--font-size-small);
  line-height: 1.6;
}

.markdown-preview blockquote.figure p:first-of-type {
  margin-top: 0;
}

.markdown-preview blockquote.figure p:last-of-type {
  margin-bottom: 0;
}

.markdown-preview blockquote.figure p img {
  margin: 12px auto;
}

.markdown-preview blockquote.figure > img {
  margin: 12px 0;
}

/* Figure 块内的其他内容样式 */
.markdown-preview blockquote.figure > *:not(img):not(::before) {
  margin: 8px 0;
}

/* 打印时移除hover效果和阴影 */
@media print {
  .markdown-preview blockquote.figure {
    box-shadow: none;
    background: #fafbfc;
  }
  .markdown-preview blockquote.figure img {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  .markdown-preview blockquote.figure img:hover {
    transform: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
}

/* =====================================================
   Color Block - 用于更改包裹字体的颜色
===================================================== */
.markdown-preview blockquote.color {
  display: inline;
  margin: 0;
  padding: 0;
  border: none;
  background: none;
  font-size: inherit;
  font-weight: inherit;
  line-height: inherit;
}

/* Color块内的所有文本继承颜色 */
.markdown-preview blockquote.color,
.markdown-preview blockquote.color * {
  color: inherit;
}

/* 预定义颜色类 */
.markdown-preview blockquote.color.red,
.markdown-preview blockquote.color.red * {
  color: #f44336 !important;
}
.markdown-preview blockquote.color.blue,
.markdown-preview blockquote.color.blue * {
  color: #2196f3 !important;
}
.markdown-preview blockquote.color.green,
.markdown-preview blockquote.color.green * {
  color: #4caf50 !important;
}
.markdown-preview blockquote.color.orange,
.markdown-preview blockquote.color.orange * {
  color: #ff9800 !important;
}
.markdown-preview blockquote.color.purple,
.markdown-preview blockquote.color.purple * {
  color: #9c27b0 !important;
}
.markdown-preview blockquote.color.gray,
.markdown-preview blockquote.color.gray * {
  color: #757575 !important;
}
.markdown-preview blockquote.color.black,
.markdown-preview blockquote.color.black * {
  color: #000000 !important;
}

/* =====================================================
   Info / Warning / Tip
===================================================== */
.markdown-preview blockquote.info,
.markdown-preview blockquote.warning,
.markdown-preview blockquote.tip {
  font-size: var(--font-size-body);
  padding: 8px 12px;
  margin: 16px 0;
  border-left: 4px solid;
  border-radius: 5px;
}

.markdown-preview blockquote.info { 
  border-color: var(--color-info); 
  background-color: #f2f8ff;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.warning { 
  border-color: var(--color-warning); 
  background-color: #ffe8e8;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}
.markdown-preview blockquote.tip { 
  border-color: var(--color-tip); 
  background-color: #e4fcf3;
  /* Prince 打印时保留背景色 */
  print-color-adjust: exact !important;
  -webkit-print-color-adjust: exact !important;
  -prince-color-adjust: exact !important;
  color-adjust: exact !important;
}

/* =====================================================
   Markdown Headings (# ## ###) - 单独控制大小
===================================================== */
.markdown-preview h1 {
  font-size: var(--font-size-h1);
  font-weight: 700;
  color: #000 !important;
  margin: 24px 0 12px 0;
  line-height: 1.3;
}

.markdown-preview h2 {
  font-size: var(--font-size-h2);
  font-weight: 700;
  color: #000 !important;
  margin: 20px 0 10px 0;
  line-height: 1.3;
}

.markdown-preview h3 {
  font-size: var(--font-size-h3);
  font-weight: 600;
  color: #000 !important;
  margin: 16px 0 8px 0;
  line-height: 1.3;
}

/* =====================================================
   Math - 行内数学 ($ $) 和块级数学 ($$ $$)
===================================================== */
/* 行内数学公式 - 在块内时放大一点 */
.markdown-preview .katex,
.markdown-preview mjx-container[display="false"] {
  font-size: 1em;
  color: #000 !important;
}

/* Chapter/Section/Subsection 内的正文 LaTeX 保持正常大小 */
.markdown-preview blockquote.chapter .katex:not(.katex-display),
.markdown-preview blockquote.chapter mjx-container[display="false"],
.markdown-preview blockquote.section .katex:not(.katex-display),
.markdown-preview blockquote.section mjx-container[display="false"],
.markdown-preview blockquote.subsection .katex:not(.katex-display),
.markdown-preview blockquote.subsection mjx-container[display="false"] {
  font-size: 1em;
}

.markdown-preview blockquote.chapter .katex-display,
.markdown-preview blockquote.chapter mjx-container[display="true"],
.markdown-preview blockquote.section .katex-display,
.markdown-preview blockquote.section mjx-container[display="true"],
.markdown-preview blockquote.subsection .katex-display,
.markdown-preview blockquote.subsection mjx-container[display="true"] {
  margin: 12px 0;
  padding: 0;
  font-size: 1em;
  width: 100%;
  box-sizing: border-box;
}

/* 只在 Definition/Theorem/Remark/Property/Algorithm/Example/Discussion 等提示块内才放大 */
.markdown-preview blockquote.definition .katex:not(.katex-display),
.markdown-preview blockquote.definition mjx-container[display="false"],
.markdown-preview blockquote.theorem .katex:not(.katex-display),
.markdown-preview blockquote.theorem mjx-container[display="false"],
.markdown-preview blockquote.remark .katex:not(.katex-display),
.markdown-preview blockquote.remark mjx-container[display="false"],
.markdown-preview blockquote.property .katex:not(.katex-display),
.markdown-preview blockquote.property mjx-container[display="false"],
.markdown-preview blockquote.algorithm .katex:not(.katex-display),
.markdown-preview blockquote.algorithm mjx-container[display="false"],
.markdown-preview blockquote.example .katex:not(.katex-display),
.markdown-preview blockquote.example mjx-container[display="false"],
.markdown-preview blockquote.discussion .katex:not(.katex-display),
.markdown-preview blockquote.discussion mjx-container[display="false"],
.markdown-preview blockquote.assumption .katex:not(.katex-display),
.markdown-preview blockquote.assumption mjx-container[display="false"],
.markdown-preview blockquote.proposal .katex:not(.katex-display),
.markdown-preview blockquote.proposal mjx-container[display="false"],
.markdown-preview blockquote.lemma .katex:not(.katex-display),
.markdown-preview blockquote.lemma mjx-container[display="false"],
.markdown-preview blockquote.proposition .katex:not(.katex-display),
.markdown-preview blockquote.proposition mjx-container[display="false"],
.markdown-preview blockquote.counterexample .katex:not(.katex-display),
.markdown-preview blockquote.counterexample mjx-container[display="false"],
.markdown-preview blockquote.objective .katex:not(.katex-display),
.markdown-preview blockquote.objective mjx-container[display="false"] {
  font-size: 1.1em;
}

.markdown-preview blockquote.definition .katex-display,
.markdown-preview blockquote.definition mjx-container[display="true"],
.markdown-preview blockquote.theorem .katex-display,
.markdown-preview blockquote.theorem mjx-container[display="true"],
.markdown-preview blockquote.remark .katex-display,
.markdown-preview blockquote.remark mjx-container[display="true"],
.markdown-preview blockquote.property .katex-display,
.markdown-preview blockquote.property mjx-container[display="true"],
.markdown-preview blockquote.algorithm .katex-display,
.markdown-preview blockquote.algorithm mjx-container[display="true"],
.markdown-preview blockquote.example .katex-display,
.markdown-preview blockquote.example mjx-container[display="true"],
.markdown-preview blockquote.discussion .katex-display,
.markdown-preview blockquote.discussion mjx-container[display="true"],
.markdown-preview blockquote.assumption .katex-display,
.markdown-preview blockquote.assumption mjx-container[display="true"],
.markdown-preview blockquote.proposal .katex-display,
.markdown-preview blockquote.proposal mjx-container[display="true"],
.markdown-preview blockquote.lemma .katex-display,
.markdown-preview blockquote.lemma mjx-container[display="true"],
.markdown-preview blockquote.proposition .katex-display,
.markdown-preview blockquote.proposition mjx-container[display="true"],
.markdown-preview blockquote.counterexample .katex-display,
.markdown-preview blockquote.counterexample mjx-container[display="true"],
.markdown-preview blockquote.objective .katex-display,
.markdown-preview blockquote.objective mjx-container[display="true"] {
  margin: 8px 0;
  padding: 0;
  font-size: 1.2em;
  width: 100%;
  box-sizing: border-box;
}

/* 块级数学公式 - 默认样式 */
.markdown-preview .katex-display,
.markdown-preview mjx-container[display="true"] {
  margin: 12px 0;
  padding: 0;
  font-size: 1em;
  color: #000 !important;
  overflow-x: auto;
  overflow-y: hidden;
}

/* 确保数学公式容器不超出块边界 */
.markdown-preview blockquote .katex-display > .katex,
.markdown-preview blockquote mjx-container[display="true"] > mjx-math {
  max-width: 100%;
  overflow-x: auto;
  overflow-y: hidden;
}

/* CD 环境（交换图）自适应 - 防止超出容器 */
.markdown-preview .katex-display .katex .cd,
.markdown-preview mjx-container[display="true"] mjx-math mjx-cd {
  display: block;
  width: 100%;
  max-width: 100%;
  overflow-x: auto;
  overflow-y: hidden;
  box-sizing: border-box;
}

/* CD 环境在块内时缩小以适应容器，让右箭头更短 */
.markdown-preview blockquote .katex-display .katex .cd,
.markdown-preview blockquote mjx-container[display="true"] mjx-math mjx-cd {
  font-size: 0.85em;
  width: 100%;
  max-width: 100%;
}

/* Definition 和 Theorem 块内的 CD 环境进一步缩小 */
.markdown-preview blockquote.definition .katex-display .katex .cd,
.markdown-preview blockquote.definition mjx-container[display="true"] mjx-math mjx-cd,
.markdown-preview blockquote.theorem .katex-display .katex .cd,
.markdown-preview blockquote.theorem mjx-container[display="true"] mjx-math mjx-cd,
.markdown-preview blockquote.discussion .katex-display .katex .cd,
.markdown-preview blockquote.discussion mjx-container[display="true"] mjx-math mjx-cd,
.markdown-preview blockquote.assumption .katex-display .katex .cd,
.markdown-preview blockquote.assumption mjx-container[display="true"] mjx-math mjx-cd,
.markdown-preview blockquote.proposal .katex-display .katex .cd,
.markdown-preview blockquote.proposal mjx-container[display="true"] mjx-math mjx-cd,
.markdown-preview blockquote.lemma .katex-display .katex .cd,
.markdown-preview blockquote.lemma mjx-container[display="true"] mjx-math mjx-cd,
.markdown-preview blockquote.proposition .katex-display .katex .cd,
.markdown-preview blockquote.proposition mjx-container[display="true"] mjx-math mjx-cd,
.markdown-preview blockquote.counterexample .katex-display .katex .cd,
.markdown-preview blockquote.counterexample mjx-container[display="true"] mjx-math mjx-cd,
.markdown-preview blockquote.objective .katex-display .katex .cd,
.markdown-preview blockquote.objective mjx-container[display="true"] mjx-math mjx-cd {
  font-size: 0.75em;
  width: 100%;
  max-width: 100%;
}

/* CD 环境内容自适应 */
.markdown-preview .katex-display .katex .cd > *,
.markdown-preview mjx-container[display="true"] mjx-math mjx-cd > * {
  box-sizing: border-box;
}

/* 确保包含 CD 环境的 katex-display 可以横向滚动 */
.markdown-preview blockquote .katex-display .cd,
.markdown-preview blockquote mjx-container[display="true"] mjx-cd {
  overflow-x: auto;
  overflow-y: hidden;
}

/* 确保父容器也支持滚动 */
.markdown-preview blockquote .katex-display {
  overflow-x: auto;
  overflow-y: hidden;
  max-width: 100%;
  width: 100%;
}

/* Prince 特定修复 - align 环境防止超出容器宽度 */
.markdown-preview blockquote .katex-display .katex {
  max-width: 100%;
  width: 100%;
  box-sizing: border-box;
}

/* align 环境在 Prince 中的特殊处理 */
.markdown-preview blockquote .katex-display .katex .katex-html {
  max-width: 100%;
  width: 100%;
  box-sizing: border-box;
}

/* align 环境的表格容器 - 关键修复 */
.markdown-preview blockquote .katex-display .katex table {
  max-width: 100% !important;
  width: 100% !important;
  box-sizing: border-box !important;
  table-layout: fixed !important;
}

/* 确保 align 环境中的所有表格元素都不会超出 */
.markdown-preview blockquote .katex-display .katex table td,
.markdown-preview blockquote .katex-display .katex table th {
  max-width: 0;
  word-wrap: break-word;
  overflow-wrap: break-word;
  box-sizing: border-box;
}

/* 特别针对 align 环境的表格行 */
.markdown-preview blockquote .katex-display .katex table.align,
.markdown-preview blockquote .katex-display .katex table[class*="align"] {
  max-width: 100% !important;
  width: 100% !important;
  table-layout: fixed !important;
  box-sizing: border-box !important;
}

/* Prince 特定的换行和溢出处理 */
@media print {
  .markdown-preview blockquote .katex-display {
    -prince-wrap: avoid-break;
    -prince-page-break-inside: avoid;
    max-width: 100% !important;
    width: 100% !important;
    box-sizing: border-box !important;
  }
  
  .markdown-preview blockquote .katex-display .katex {
    max-width: 100% !important;
    width: 100% !important;
    box-sizing: border-box !important;
  }
  
  .markdown-preview blockquote .katex-display .katex .katex-html {
    max-width: 100% !important;
    width: 100% !important;
    box-sizing: border-box !important;
  }
  
  /* 强制所有表格适应容器 */
  .markdown-preview blockquote .katex-display .katex table {
    max-width: 100% !important;
    width: 100% !important;
    table-layout: fixed !important;
    box-sizing: border-box !important;
  }
  
  /* 确保表格单元格不会超出 - 使用 max-width: 0 让表格自动适应 */
  .markdown-preview blockquote .katex-display .katex table td,
  .markdown-preview blockquote .katex-display .katex table th {
    max-width: 0 !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    box-sizing: border-box !important;
  }
  
  /* 确保 align 环境的容器也不会超出 */
  .markdown-preview blockquote.definition .katex-display,
  .markdown-preview blockquote.property .katex-display {
    max-width: 100% !important;
    width: 100% !important;
    overflow-x: auto !important;
    box-sizing: border-box !important;
  }
}

/* Lists & Math */
.markdown-preview blockquote ul,
.markdown-preview blockquote ol { margin-left: 22px; }

/* =====================================================
   Auto-generated TOC container
===================================================== */
#toc {
  margin-bottom: 40px;
  padding-left: 12px;
  border-left: 3px solid #888;
}

#toc ul { list-style: none; padding-left: 12px; }
#toc li { margin: 4px 0; }
#toc a { text-decoration: none; color: #000 !important; }
