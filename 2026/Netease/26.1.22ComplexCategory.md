<script>
function generateTOC() {
  const toc = document.getElementById("toc");
  if (!toc) return;

  const headers = document.querySelectorAll("h1, h2, h3");
  const ul = document.createElement("ul");
  ul.className = "toc-list";

  let h1Count = 0, h2Count = 0, h3Count = 0;

  headers.forEach((h, i) => {
    if (h.closest("#toc-page")) return; // 跳过目录页自身标题
    if (!h.id) h.id = "sec-" + i;

    let number = "";
    if (h.tagName === "H1") {
      h1Count++; h2Count = 0; h3Count = 0;
      number = `${h1Count}`;
    } else if (h.tagName === "H2") {
      h2Count++; h3Count = 0;
      number = `${h1Count}.${h2Count}`;
    } else if (h.tagName === "H3") {
      h3Count++;
      number = `${h1Count}.${h2Count}.${h3Count}`;
    }

    const li = document.createElement("li");
    li.className = "toc-" + h.tagName.toLowerCase();

    const a = document.createElement("a");
    a.href = "#" + h.id;

    const title = document.createElement("span");
    title.className = "toc-title";
    title.textContent = number + " " + h.textContent; // TOC 自动编号 + 标题

    const leader = document.createElement("span");
    leader.className = "toc-leader";

    a.appendChild(title);
    a.appendChild(leader);
    li.appendChild(a);
    ul.appendChild(li);
  });

  toc.appendChild(ul);
}

window.addEventListener("load", generateTOC);
</script>
<blockquote class="cover-page">
  <div class="cover-title">从范畴论到词表构建</div>
  <blockquote class="cover-subtitle">
  复形范畴中的极限与余极限及其在BPE中的应用与逆向分裂的探索
  </blockquote>
  <div class="cover-meta-group">
    <div class="cover-author">Igza Vit</div>
    <div class="cover-date">2026.1.22</div>
  </div>
</blockquote>

<blockquote class="preface">

# 序言

　本笔记旨在建立复形范畴（simplicial complex category）与词表构建算法之间的理论桥梁。我们以范畴论为语言，将Byte Pair Encoding (BPE) 理解为复形范畴上的余极限操作，并探索是否存在一个对偶的极限过程——我们称之为"逆向分裂"（inverse splitting）——能够作为BPE的数学对偶。这是一个开放性问题：我们试图通过范畴论的理论框架，寻找或设计这样一个算法。

　　笔记分为三个主要部分：首先，我们建立基础概念框架，包括单纯形、单纯复形、共轭复形等核心定义，并引入加权复形与有向单纯复形以适应实际应用场景；其次，我们系统阐述复形范畴中的极限与余极限理论，包括积、拉回、余积、推出等核心构造，并探讨函子与伴随对的理论基础；最后，我们将理论应用于BPE算法，并探索是否存在一个对偶的"逆向分裂"算法，展示如何通过范畴论的视角理解词表构建的本质过程，以及如何设计BPE的对偶算法。

　　特别地，我们引入了代数拓扑中的同调理论与信息论中的渐进均分性（AEP），为设计逆向分裂算法提供了严格的数学基础。通过共轭复形的概念，我们探索了BPE与潜在逆向分裂算法之间的对偶关系：前者在原复形中通过余极限聚合原子为Token，后者（如果存在）应在共轭复形中通过极限分解全局模式为极小原子簇。

　　本笔记的目标读者是熟悉范畴论基础、对拓扑学有一定了解、并希望将抽象数学理论应用于实际算法设计的读者。我们力求在保持理论严谨性的同时，通过丰富的例子和直观的解释，使抽象概念变得可操作。

</blockquote>

<div id="toc-page">
  <h1>Contents</h1>
  <div id="toc"></div>
</div>

<blockquote class="chapter">

# 基础概念：单纯形与单纯复形

　　本章节建立复形范畴的基础概念框架。我们从最简单的组合对象——单纯形——开始，逐步构建更复杂的结构。单纯形是组合拓扑学的基本单元，它为我们提供了描述高维空间组合结构的方法。

<blockquote class="section">

## 单纯形（Simplex）

　　单纯形是组合拓扑学中最基本的几何对象。从直观上看，单纯形是点、线段、三角形、四面体等几何对象在组合意义上的抽象。在复形范畴中，单纯形不仅是几何对象，更是组合结构的载体。

<blockquote class="definition">

**单纯形**

给定非空有限顶点集 $V$，一个**单纯形** $\sigma$ 是 $V$ 的一个有限子集，即 $\sigma \subseteq V$ 且 $|\sigma| < \infty$。

单纯形 $\sigma$ 的**维度**定义为其顶点数减1：
$$
\dim \sigma = |\sigma| - 1
$$

- 0维单纯形：单点集 $\{v\}$，称为**顶点**；
- 1维单纯形：两点集 $\{v_1, v_2\}$，称为**边**；
- 2维单纯形：三点集 $\{v_1, v_2, v_3\}$，称为**三角形**；
- 3维单纯形：四点集 $\{v_1, v_2, v_3, v_4\}$，称为**四面体**。

对单纯形 $\sigma$，若 $\tau \subseteq \sigma$，则称 $\tau$ 是 $\sigma$ 的**面**（face）。
</blockquote>

<blockquote class="example">

**单纯形的例子**

设顶点集 $V = \{a, b, c\}$，则：
- $\{a\}$ 是0维单纯形（顶点）；
- $\{a, b\}$ 是1维单纯形（边）；
- $\{a, b, c\}$ 是2维单纯形（三角形）；
- $\{a\}$ 和 $\{a, b\}$ 都是 $\{a, b, c\}$ 的面。
</blockquote>

</blockquote>

　　单纯形为我们提供了基本的组合单元，但单独一个单纯形还不足以描述复杂的结构。我们需要将多个单纯形按照一定的规则组合起来，形成单纯复形。单纯复形通过"闭包公理"保证了结构的完整性：如果一个单纯形属于复形，那么它的所有面也必须属于这个复形。

<blockquote class="section">

## 单纯复形（Simplicial Complex）

　　单纯复形是单纯形的集合，它满足一定的组合约束。这些约束保证了复形在拓扑意义上是"良好"的：每个单纯形的面都在复形中，从而避免了"悬挂"的边或"不完整"的三角形。

<blockquote class="definition">

**单纯复形**

给定非空顶点集 $V$，一个**单纯复形**（或简称**复形**）$K$ 是 $V$ 的有限子集族（即单纯形的集合），满足以下三条公理：

1. **单点集公理**：若 $v \in V$，则 $\{v\} \in K$（所有顶点自身都是0维单纯形）；
2. **闭包公理**：若 $\sigma \in K$ 且 $\tau \subseteq \sigma$，则 $\tau \in K$（单纯形的任意面仍是该复形的单纯形）；
3. **局部有限性**：对任意 $v \in V$，仅含 $v$ 为顶点的单纯形个数有限。

复形 $K$ 的**维度**定义为所含单纯形的最大维度：
$$
\dim K = \max\{\dim \sigma \mid \sigma \in K\}
$$

若 $\dim K = d$，则称 $K$ 为**$d$维复形**。
</blockquote>

<blockquote class="remark">

**术语说明**

在本笔记中，**"复形"**一词特指**"单纯复形"**，即满足上述三条公理的单纯形集合。复形 $K$ 由两部分组成：
- **顶点集** $V_K$：复形中所有0维单纯形的顶点集合；
- **单纯形族** $K$：复形中所有单纯形的集合（包含顶点、边、三角形等）。
</blockquote>

<blockquote class="example">

**单纯复形的例子**

设顶点集 $V = \{a, b, c\}$，则：
- $K_1 = \{\{a\}, \{b\}, \{c\}\}$ 是0维复形（仅含顶点）；
- $K_2 = \{\{a\}, \{b\}, \{c\}, \{a, b\}, \{a, c\}\}$ 是1维复形（含顶点和边）；
- $K_3 = \{\{a\}, \{b\}, \{c\}, \{a, b\}, \{a, c\}, \{b, c\}, \{a, b, c\}\}$ 是2维复形（完整的三角形）。

注意：$K_2$ 不包含 $\{b, c\}$，因此不能形成完整的三角形。

**可视化**：单纯复形可以形象地理解为**超图**（hypergraph），其中：
- 顶点是0维单纯形（超图的节点）
- 边、三角形、四面体等高维单纯形是超图的超边（hyperedge）
- 复形的闭包公理保证了超边的"面"也是超边

![单纯复形可视化](images/figure1_simplicial_complex.png)
</blockquote>

</blockquote>

　　单纯复形为我们提供了描述组合结构的数学语言。然而，在实际应用中，我们往往需要处理更复杂的结构：不仅要考虑单纯形之间的包含关系，还要考虑它们之间的"对偶"关系。共轭复形正是这样一种结构，它通过"顶点-单纯形反转"的方式，为我们提供了从另一个角度观察复形的工具。

<blockquote class="section">

## 共轭复形（Conjugate Complex）
<blockquote class="definition">

共轭复形的定义
设 $K$ 为 $n$ 维单纯复形，其共轭复形 $K^*$ 是满足“顶点-单纯形反转”的对偶复形，构造如下：
1. 顶点集：$V_{K^*} = \{ \sigma \mid \sigma \in K \}$（原复形的每个单纯形作为共轭复形的顶点）；
2. 单纯形族：对任意 $\tau \subseteq V_{K^*}$，$\tau \in K^*$ 当且仅当 $\{ \sigma \mid \sigma \in \tau \}$ 是原复形 $K$ 中的一个“闭覆盖”（即 $\bigcup_{\sigma \in \tau} \sigma$ 是 $K$ 的子复形，且 $\tau$ 满足极小性：不可被更小的子集覆盖替代）；
3. 低维截断：继承原复形的1~3维约束，$K^*$ 仅保留顶点对应原复形1~3维单纯形的子复形（避免高维冗余）。

共轭复形的核心性质：
- 对偶性：$(K^*)^* \cong K$（共轭复形的共轭复形同构于原复形）；
- 维度反转：若 $K$ 的维度为 $d$，则 $K^*$ 的维度为 $\max\{ k \mid \exists \tau \subseteq K_d, \tau \text{ 是闭覆盖} \}$（通常与原复形维度一致，适配1~3维约束）。

![共轭复形构造](images/figure4_conjugate_complex.png)

![共轭复形的超图变换](images/figure6_conjugate_transformation.png)
</blockquote>
</blockquote>

　　共轭复形为我们提供了观察复形的"对偶视角"，但要真正建立复形之间的映射关系，我们需要引入单纯映射的概念。单纯映射是复形范畴中的态射，它保持了复形的组合结构，使得我们可以在不同的复形之间建立有意义的对应关系。

<blockquote class="section">

## 单纯映射（Simplicial Map）

<blockquote class="definition">

**单纯映射**

　　单纯映射是复形之间的结构保持映射。它不仅将顶点映射到顶点，更重要的是，它将单纯形映射到单纯形（或更低维的单纯形），从而保持了复形的组合结构。这种结构保持性使得我们可以通过映射来比较不同的复形。

设 $K, L$ 为两个单纯复形，顶点集分别为 $V_K, V_L$。函数 $f: V_K \to V_L$ 称为从 $K$ 到 $L$ 的**单纯映射**（simplicial map），若满足：

对任意单纯形 $\sigma = \{v_1, v_2, ..., v_n\} \in K$，其像集 $f(\sigma) = \{f(v_1), f(v_2), ..., f(v_n)\}$ 也是 $L$ 中的单纯形，即 $f(\sigma) \in L$。

**延拓**：单纯映射 $f: V_K \to V_L$ 可自然延拓到全体单纯形上：对任意 $\sigma \in K$，定义 $f(\sigma) = \{f(v) \mid v \in \sigma\}$。延拓后的映射仍记为 $f: K \to L$。

**直观理解**：单纯映射是"保持单纯形结构"的顶点映射——将复形 $K$ 的顶点映射到复形 $L$ 的顶点，且保证 $K$ 中的每个单纯形都被映射到 $L$ 中的某个单纯形（可能是低维的）。
</blockquote>

<blockquote class="property">

**单纯映射的性质**

1. **维度单调性**：对任意 $\sigma \in K$，$\dim f(\sigma) \leq \dim \sigma$（映射可能降低维度，但不会增加）；
2. **复合封闭性**：若 $f: K \to L$、$g: L \to M$ 均为单纯映射，则复合映射 $g \circ f: K \to M$ 也是单纯映射；
3. **恒等映射**：对任意复形 $K$，存在恒等单纯映射 $\text{id}_K: K \to K$，满足 $\text{id}_K(v) = v$ 对所有 $v \in V_K$ 成立。
</blockquote>

<blockquote class="example">

**单纯映射的例子**

设 $K = \{\{a\}, \{b\}, \{a,b\}\}$，$L = \{\{x\}, \{y\}, \{x,y\}\}$，则：
- $f: a \mapsto x, b \mapsto y$ 是单纯映射（边映射到边）；
- $g: a \mapsto x, b \mapsto x$ 也是单纯映射（边映射到顶点，维度降低）；
- $h: a \mapsto x, b \mapsto y, c \mapsto z$（若 $c \in V_K$ 但 $\{a,c\} \notin K$）不是单纯映射（若 $\{a,c\} \in K$，则 $h(\{a,c\}) = \{x,z\}$ 必须在 $L$ 中）。
</blockquote>

</blockquote>

　　有了单纯映射作为态射，我们就可以将所有的单纯复形组织成一个范畴。这个范畴——复形范畴——不仅为我们提供了研究复形的统一框架，更重要的是，它是一个完备且余完备的范畴，这意味着极限与余极限的存在性得到了保证。

<blockquote class="section">

## 复形范畴

<blockquote class="definition">

　　有了单纯映射作为态射，我们就可以将所有的单纯复形组织成一个范畴。这个范畴不仅包含了所有的复形对象，更重要的是，它通过态射（单纯映射）建立了复形之间的关系，使得我们可以用范畴论的语言来研究复形。

复形范畴 $\mathbf{Comp}$ 由以下三部分构成：

1. 对象类 $\text{Ob}(\mathbf{Comp})$：全体单纯复形；
2. 态射集 $\text{Hom}(K, L)$：对任意 $K, L \in \text{Ob}(\mathbf{Comp})$，$\text{Hom}(K, L)$ 为所有从 $K$ 到 $L$ 的单纯映射；
3. 复合运算 $\circ$：对任意 $f \in \text{Hom}(K, L)$、$g \in \text{Hom}(L, M)$，复合运算 $g \circ f \in \text{Hom}(K, M)$ 为单纯映射的复合。

该范畴满足范畴公理：结合律 $(h \circ g) \circ f = h \circ (g \circ f)$，且对任意对象存在恒等态射。
</blockquote>

<blockquote class="property">

复形范畴的核心性质
1. 完备性：$\mathbf{Comp}$ 是完备范畴，即对任意小图表 $\mathcal{D}: \mathcal{I} \to \mathbf{Comp}$，均存在极限 $\lim_{\leftarrow} \mathcal{D}$；
2. 余完备性：$\mathbf{Comp}$ 是余完备范畴，即对任意小图表 $\mathcal{D}: \mathcal{I} \to \mathbf{Comp}$，均存在余极限 $\lim_{\rightarrow} \mathcal{D}$；
3. 全子范畴继承性：若 $\mathbf{C}$ 是 $\mathbf{Comp}$ 的全子范畴（对象为 $\mathbf{Comp}$ 的子集，态射与 $\mathbf{Comp}$ 一致），则 $\mathbf{C}$ 继承 $\mathbf{Comp}$ 的完备性/余完备性（若图表 $\mathcal{D}$ 的对象均在 $\mathbf{C}$ 中）。
</blockquote>

</blockquote>

　　复形范畴为我们提供了研究复形结构的抽象框架，但在实际应用中，我们往往需要处理带有额外信息的复形。例如，在分析交互序列时，我们需要考虑物品之间的时序关系（有向性）和共现频率（权重）。加权复形与有向单纯复形正是为了满足这些实际需求而引入的概念。

<blockquote class="section">

## 加权复形与有向单纯复形

<blockquote class="definition">

　　在实际应用中，我们往往需要为复形中的单纯形赋予额外的信息。权重可以表示频率、重要性或概率等量，而有向性则可以表示时序关系或因果关系。这些额外的结构使得复形能够更好地描述实际数据。

**加权复形（Weighted Complex）**

设 $K$ 为单纯复形，**加权复形** $(K, w)$ 是在 $K$ 上赋予权重函数 $w: K \to \mathbb{R}_{\geq 0}$ 的复形，其中 $w(\sigma)$ 表示单纯形 $\sigma$ 的权重。

**有向单纯复形（Oriented Simplicial Complex）**

设 $K$ 为单纯复形，**有向单纯复形** $(K, \text{or})$ 是在 $K$ 上赋予定向函数 $\text{or}: K \to \{\pm 1\}$ 的复形，其中对 $d$ 维单纯形 $\sigma = \{v_0, v_1, ..., v_d\}$，$\text{or}(\sigma)$ 表示其顶点的排列顺序（等价于定向）。

**有向加权复形**：同时具有权重和定向的复形 $(K, w, \text{or})$。
</blockquote>

<blockquote class="example">

**加权复形的例子**

在交互序列分析中，设 $K$ 为物品交互复形：
- 顶点 $\{i\}$ 的权重 $w(\{i\})$ 可表示物品 $i$ 的出现频率；
- 边 $\{i, j\}$ 的权重 $w(\{i, j\})$ 可表示物品对 $(i, j)$ 的共现频率；
- 三角形 $\{i, j, k\}$ 的权重 $w(\{i, j, k\})$ 可表示三元组 $(i, j, k)$ 的共现频率。

**有向单纯复形的例子**

在序列数据中，有向边 $\overrightarrow{(i, j)}$ 表示"物品 $i$ 在物品 $j$ 之前出现"，有向三角形 $\overrightarrow{(i, j, k)}$ 表示"物品 $i \to j \to k$ 的时序关系"。

![有向加权复形构造](images/figure5_weighted_directed_complex.png)
</blockquote>

<blockquote class="remark">

**加权与有向的动机**

在设计逆向分裂算法时，我们需要考虑如何从交互序列构造全局交互复形：
- **加权**：通过频率统计，识别"典型"的交互模式（高频单纯形）；
- **有向**：通过时序关系，捕捉物品间的因果关系（$i \to j$ 表示 $i$ 先于 $j$ 出现）。

这种"加权+有向"的结构为极限过程提供了自然的约束条件。
</blockquote>

</blockquote>

</blockquote>

<blockquote class="chapter">

# 代数拓扑：同调与信息论基础

<blockquote class="section">

## 链复形与边界算子

<blockquote class="definition">

链复形是代数拓扑的核心工具。它将几何问题转化为代数问题：通过将单纯形视为"基向量"，我们可以用线性代数的方法来研究复形的拓扑性质。边界算子则告诉我们如何从高维单纯形"提取"低维边界。

**链群（Chain Group）**

设 $K$ 为单纯复形，$C_d(K)$ 表示 $K$ 的 $d$ 维**链群**，即所有 $d$ 维单纯形的形式线性组合：
$$
C_d(K) = \left\{ \sum_{\sigma \in K_d} c_\sigma \sigma \mid c_\sigma \in \mathbb{Z} \right\}
$$
其中 $K_d = \{\sigma \in K \mid \dim \sigma = d\}$ 为 $d$ 维单纯形集合。

**边界算子（Boundary Operator）**

对 $d$ 维单纯形 $\sigma = \{v_0, v_1, ..., v_d\}$，其**边界算子** $\partial_d: C_d(K) \to C_{d-1}(K)$ 定义为：
$$
\partial_d(\sigma) = \sum_{i=0}^{d} (-1)^i \{v_0, ..., \hat{v_i}, ..., v_d\}
$$
其中 $\hat{v_i}$ 表示删除顶点 $v_i$，$(-1)^i$ 为定向符号。

**链复形（Chain Complex）**

链复形是链群与边界算子的序列：
$$
\cdots \xrightarrow{\partial_{d+1}} C_d(K) \xrightarrow{\partial_d} C_{d-1}(K) \xrightarrow{\partial_{d-1}} \cdots
$$
满足 $\partial_d \circ \partial_{d+1} = 0$（边界无边界）。
</blockquote>

<blockquote class="property">

**边界算子的性质**

1. **零性**：$\partial_d \circ \partial_{d+1} = 0$（边界无边界）；
2. **线性性**：$\partial_d(\alpha \sigma + \beta \tau) = \alpha \partial_d(\sigma) + \beta \partial_d(\tau)$；
3. **维度降低**：$\partial_d: C_d(K) \to C_{d-1}(K)$ 将 $d$ 维链映射到 $(d-1)$ 维链。
</blockquote>

</blockquote>

　　边界算子为我们提供了研究复形局部结构的方法，但更重要的是，我们可以通过边界算子定义同调群，从而捕捉复形的全局拓扑特征。同调群量化了复形中的"洞"和"空腔"，而Betti数则给出了这些拓扑特征的数量。

<blockquote class="section">

## 同调群与Betti数

<blockquote class="definition">

边界算子为我们提供了研究复形局部结构的方法，但更重要的是，我们可以通过边界算子定义同调群。同调群捕捉了复形中的"洞"和"空腔"——这些是拓扑不变量，不依赖于复形的具体表示方式。

**同调群（Homology Group）**

设 $K$ 为单纯复形，$d$ 维**同调群**定义为：
$$
H_d(K) = \frac{\ker \partial_d}{\text{im} \ \partial_{d+1}} = \frac{Z_d(K)}{B_d(K)}
$$
其中：
- $Z_d(K) = \ker \partial_d$ 为 $d$ 维**闭链群**（cycles，边界为零的链）；
- $B_d(K) = \text{im} \ \partial_{d+1}$ 为 $d$ 维**边界链群**（boundaries，某 $(d+1)$ 维链的边界）。

**Betti数（Betti Number）**

$d$ 维**Betti数** $\beta_d(K)$ 定义为 $d$ 维同调群的秩（自由部分的维数）：
$$
\beta_d(K) = \text{rank} \ H_d(K)
$$

**直观理解**：
- $\beta_0(K)$：连通分支数；
- $\beta_1(K)$："洞"的个数（1维同调，如圆环）；
- $\beta_2(K)$："空腔"的个数（2维同调，如球面）。
</blockquote>

<blockquote class="example">

**同调群的例子**

设 $K$ 为三角形复形 $\{\{a\}, \{b\}, \{c\}, \{a,b\}, \{b,c\}, \{a,c\}, \{a,b,c\}\}$：
- $H_0(K) \cong \mathbb{Z}$（$\beta_0 = 1$，一个连通分支）；
- $H_1(K) = 0$（$\beta_1 = 0$，无洞）；
- $H_2(K) = 0$（$\beta_2 = 0$，无空腔）。

若 $K$ 为圆环（仅边界，无内部），则 $\beta_1 = 1$（一个洞）。
</blockquote>

<blockquote class="remark">

**同调在逆向分裂设计中的意义**

在设计逆向分裂算法时，同调群可以帮助我们识别"不可约的"交互模式：
- **闭链** $Z_d(K)$：表示 $d$ 维的"闭合"交互模式（如循环推荐路径）；
- **边界链** $B_d(K)$：表示 $d$ 维的"可分解"交互模式（可由更高维模式导出）；
- **同调类** $H_d(K)$：表示 $d$ 维的"本质"交互模式（不可由更高维模式导出，也不可分解为更低维模式）。

Betti数 $\beta_d$ 量化了 $d$ 维"本质模式"的数量，为极限过程提供了自然的"极小性"判据。
</blockquote>

</blockquote>

　　同调理论为我们提供了研究复形拓扑结构的工具，但在从实际数据构造复形时，我们还需要考虑数据的统计特性。信息论中的渐进均分性（AEP）告诉我们，当样本量足够大时，数据中的"典型"模式会收敛到理论分布，这为我们在极限过程中识别"典型"交互模式提供了理论依据。

<blockquote class="section">

## 信息论基础：典范集与渐进均分性

<blockquote class="definition">

信息论为我们提供了从统计角度理解数据的工具。渐进均分性（AEP）告诉我们，当样本量足够大时，数据中的"典型"模式会占据主导地位，而"非典型"模式会逐渐消失。这为我们在极限过程中识别"典型"交互模式提供了理论依据。

**典范集（Typical Set）**

设 $X_1, X_2, ..., X_n$ 为独立同分布的随机变量序列，其联合概率为 $p(x_1, ..., x_n) = \prod_{i=1}^n p(x_i)$。对 $\epsilon > 0$，**$\epsilon$-典范集** $A_\epsilon^{(n)}$ 定义为：
$$
A_\epsilon^{(n)} = \left\{ (x_1, ..., x_n) \mid \left| -\frac{1}{n} \log p(x_1, ..., x_n) - H(X) \right| < \epsilon \right\}
$$
其中 $H(X) = -\sum_x p(x) \log p(x)$ 为熵。

**渐进均分性（Asymptotic Equipartition Property, AEP）**

渐进均分性定理：对任意 $\epsilon > 0$，当 $n \to \infty$ 时：
1. $P(A_\epsilon^{(n)}) > 1 - \epsilon$（典范集的概率趋于1）；
2. $|A_\epsilon^{(n)}| \leq 2^{n(H(X) + \epsilon)}$（典范集的大小上界）；
3. $|A_\epsilon^{(n)}| \geq (1 - \epsilon) 2^{n(H(X) - \epsilon)}$（典范集的大小下界）。

**直观理解**：当样本量 $n$ 足够大时，几乎所有序列的"典型"概率约为 $2^{-nH(X)}$，且典型序列的数量约为 $2^{nH(X)}$。
</blockquote>

<blockquote class="property">

**典范集的性质**

1. **高概率性**：当 $n$ 足够大时，随机序列几乎必然落在典范集中；
2. **等概率性**：典范集中的序列具有近似相等的概率（约 $2^{-nH(X)}$）；
3. **指数增长**：典范集的大小以 $2^{nH(X)}$ 的速率增长（熵决定增长率）。
</blockquote>

<blockquote class="remark">

**AEP在逆向分裂设计中的意义**

在设计从交互序列构造全局交互复形的过程时，AEP提供了理论指导：
- **典型性判据**：随着样本量 $n \to \infty$，交互序列中的"典型"模式（高频单纯形）会收敛到典范集，其频率收敛到理论概率；
- **权重收敛**：有向边 $\overrightarrow{(i, j)}$ 的权重 $w(\{i, j\})$ 在 $n \to \infty$ 时收敛到 $p(i, j)$（若收敛于0，则对应这两个物品没有稳定的先后关系）；
- **极限构造**：全局交互复形的构造本质是识别"典型"交互模式（典范集中的元素），通过极限过程提取不可约的原子簇。

这种"典型性+极限"的框架为设计逆向分裂算法提供了严格的信息论基础。**注意**：从序列构造全局复形本身是一个开放性问题，AEP提供了渐近理论，但实际构造仍需结合工程约束。
</blockquote>

</blockquote>

</blockquote>

　　在建立了基础概念框架之后，我们现在转向复形范畴的核心构造：极限与余极限。这些构造不仅是范畴论的核心概念，更是我们理解BPE算法和探索其潜在对偶算法的关键。极限与余极限分别对应"分解"与"聚合"两种操作，它们通过泛性质保证了构造的唯一性和最优性。我们希望通过极限理论，找到或设计一个与BPE对偶的算法。

<blockquote class="chapter">

#  复形范畴的极限与余极限

<blockquote class="section">

## 极限的定义与核心构造

极限是范畴论中最重要的构造之一。它通过"泛性质"来定义，这意味着极限不是通过具体的构造方式定义的，而是通过它与其他对象的关系来定义的。这种定义方式使得极限具有了"最优性"：它是满足某种条件的所有对象中"最好"的那个。

<blockquote class="definition">

**极限（Limit）**

设 $\mathcal{I}$ 为小指标范畴，$\mathcal{D}: \mathcal{I} \to \mathbf{Comp}$ 为图表（将 $\mathcal{I}$ 的对象映射到复形，态射映射到单纯映射）。

图表 $\mathcal{D}$ 的**极限**是一个复形 $L \in \text{Ob}(\mathbf{Comp})$ 及一族**投影态射** $\{\pi_i: L \to \mathcal{D}(i)\}_{i \in \mathcal{I}}$，满足以下**泛性质**：

对任意复形 $X \in \text{Ob}(\mathbf{Comp})$ 及态射族 $\{f_i: X \to \mathcal{D}(i)\}_{i \in \mathcal{I}}$，存在**唯一**态射 $f: X \to L$，使得对所有 $i \in \mathcal{I}$，$\pi_i \circ f = f_i$。

极限记为 $\lim_{\leftarrow} \mathcal{D}$ 或 $\lim \mathcal{D}$。

**直观理解**：极限是"最通用的对象"，能够通过投影"分解"到图表中的每个对象，且这种分解是"最经济的"（任何其他对象到图表对象的映射，都能唯一地通过极限"中介"）。
</blockquote>

<blockquote class="remark">

**极限的直观类比**

极限类似于集合论中的**交集**或**笛卡尔积**：
- 积（Product）：多个复形的"最大公共子结构"；
- 拉回（Pullback）：在约束条件下的"最大公共子结构"。

极限的核心是"分解"（decomposition）——从整体分解到部分。
</blockquote>

<blockquote class="remark">

**极限的动机：探索BPE的对偶过程**

在分析BPE算法时，我们发现它本质上是复形范畴上的余极限过程（从原子聚合为Token）。我们探索是否存在一个对偶的极限过程——逆向分裂——使得：
- 输入是全局的交互模式（高维单纯形）；
- 输出是极小的原子簇（低维单纯形）；
- 通过拉回构造，在约束条件下分解整体为基元。

这种"分解"的极限过程与BPE的"聚合"余极限过程在理论上形成自然的对偶关系。**注意**：这样的算法是否存在、如何实现，仍是一个开放性问题。
</blockquote>

<blockquote class="example">

积是最简单的极限构造。它通过"同时包含两个复形的信息"来构造一个新的复形。在复形范畴中，积的构造是通过顶点的笛卡尔积来实现的，这保证了新复形包含了原复形的所有信息。

**核心构造1：积（Product）**

对任意两个复形 $K, L \in \text{Ob}(\mathbf{Comp})$，其**积** $K \times L$ 定义为：

1. **顶点集**：$V_{K \times L} = V_K \times V_L$（顶点的笛卡尔积，即所有有序对 $(v, w)$，其中 $v \in V_K, w \in V_L$）；
2. **单纯形族**：$\sigma \in K \times L$ 当且仅当 $\sigma$ 是 $V_{K \times L}$ 的有限子集，且其在 $K$、$L$ 上的投影（分别取第一、第二分量）分别为 $K$、$L$ 中的单纯形。

**投影态射**：$\pi_1: K \times L \to K$ 和 $\pi_2: K \times L \to L$ 分别定义为取顶点的第一、第二分量。

**泛性质交换图**：
$$
\begin{CD}
X @>{f_1}>> K \\
@V{f_2}VV @AA{\pi_1}A \\
L @>>{\pi_2}> K \times L \\
@. @AA{\exists! f}A \\
@. X
\end{CD}
$$

**直观理解**：积是"同时包含 $K$ 和 $L$ 的信息"的最大对象，通过投影可以"提取"任一因子的信息。
</blockquote>

<blockquote class="example">

拉回是积的推广。它不仅在两个复形之间构造积，还要求这个积与第三个复形通过态射"对齐"。这种对齐关系使得拉回能够捕捉"公共子结构"，这正是我们在设计逆向分裂算法时希望捕捉的"极小原子簇"的数学本质。

**核心构造2：拉回（Pullback）**

给定态射 $f: K \to M$、$g: L \to M$，**拉回** $K \times_M L$ 是满足 $f \circ \pi_1 = g \circ \pi_2$ 的极限对象。

**核心交换方块**：
$$
\begin{CD}
K \times_M L @>{\pi_1}>> K \\
@V{\pi_2}VV @VV{f}V \\
L @>>{g}> M
\end{CD}
$$

**拉回的具体构造**：
1. **顶点集**：$V_{K \times_M L} = \{(v, w) \in V_K \times V_L \mid f(v) = g(w)\}$（仅保留在 $M$ 中"匹配"的顶点对）；
2. **单纯形族**：$\sigma \in K \times_M L$ 当且仅当 $\pi_1(\sigma) \in K$ 且 $\pi_2(\sigma) \in L$（投影后仍为单纯形）。

**直观理解**：拉回是"在约束 $M$ 下，$K$ 和 $L$ 的最大公共子结构"——只保留那些在 $M$ 中"对齐"的部分。

**拉回的交换图**（使用LaTeX CD环境）：
$$
\begin{CD}
K \times_M L @>{\pi_1}>> K \\
@V{\pi_2}VV @VV{f}V \\
L @>>{g}> M
\end{CD}
$$
</blockquote>

</blockquote>

　　极限为我们提供了"分解"的数学工具，而余极限则提供了"聚合"的工具。在复形范畴中，余极限通过"粘贴"的方式将多个复形组合成一个更大的复形，这正是BPE算法中"合并原子为Token"的数学本质。

<blockquote class="section">

## 余极限的定义与核心构造

余极限是极限的对偶概念。如果说极限对应"分解"（从整体到部分），那么余极限就对应"聚合"（从部分到整体）。在复形范畴中，余极限通过"粘贴"的方式将多个复形组合成一个更大的复形，这正是BPE算法中"合并原子为Token"的数学本质。

<blockquote class="definition">

**余极限（Colimit）**

设 $\mathcal{I}$ 为小指标范畴，$\mathcal{D}: \mathcal{I} \to \mathbf{Comp}$ 为图表。

图表 $\mathcal{D}$ 的**余极限**是一个复形 $C \in \text{Ob}(\mathbf{Comp})$ 及一族**嵌入态射** $\{\iota_i: \mathcal{D}(i) \to C\}_{i \in \mathcal{I}}$，满足以下**泛性质**：

对任意复形 $Y \in \text{Ob}(\mathbf{Comp})$ 及态射族 $\{g_i: \mathcal{D}(i) \to Y\}_{i \in \mathcal{I}}$，存在**唯一**态射 $g: C \to Y$，使得对所有 $i \in \mathcal{I}$，$g \circ \iota_i = g_i$。

余极限记为 $\lim_{\rightarrow} \mathcal{D}$ 或 $\text{colim} \mathcal{D}$。

**直观理解**：余极限是"最通用的对象"，能够通过嵌入"包含"图表中的每个对象，且这种包含是"最经济的"（任何从图表对象到其他对象的映射，都能唯一地通过余极限"中介"）。
</blockquote>

<blockquote class="remark">

**余极限的直观类比**

余极限类似于集合论中的**并集**或**商集**：
- 余积（Coproduct）：多个复形的"最小公共超结构"（无交并）；
- 推出（Pushout）：在约束条件下的"最小公共超结构"（模等价关系）。

余极限的核心是"聚合"（aggregation）——从部分聚合到整体。
</blockquote>

<blockquote class="remark">

**余极限的动机：BPE的范畴论诠释**

BPE（Byte Pair Encoding）算法的核心操作是迭代地将频繁出现的相邻Token对合并为新Token。从复形范畴的视角看，这个过程可以精确地描述为余极限：
- 初始状态：原子集合（0维单纯形）对应预设的字符表；
- 迭代过程：通过推出构造，在"连续子串"约束下，将低维单纯形（原子/低维Token）粘贴为高维单纯形（高维Token）；
- 最终状态：完整的BPE词表对应原复形 $K$ 的1~3维单纯形族。

这种"聚合"的余极限过程为BPE提供了严格的数学框架，同时也启发我们寻找对偶的极限过程作为逆向算法。
</blockquote>

<blockquote class="example">

余积是最简单的余极限构造。它通过"无交并"的方式将两个复形组合在一起，不进行任何"粘贴"操作。这种构造保证了原复形的结构完全保留，同时新复形包含了两个原复形的所有信息。

**核心构造1：余积（Coproduct）**

对任意两个复形 $K, L \in \text{Ob}(\mathbf{Comp})$，其**余积** $K \sqcup L$ 定义为：

1. **顶点集**：$V_{K \sqcup L} = V_K \sqcup V_L$（顶点的无交并，即 $K$ 和 $L$ 的顶点"并排放置"，不重叠）；
2. **单纯形族**：$\sigma \in K \sqcup L$ 当且仅当 $\sigma \subseteq V_K$ 且 $\sigma \in K$，或 $\sigma \subseteq V_L$ 且 $\sigma \in L$（单纯形来自 $K$ 或 $L$，但不能跨两者）。

**嵌入态射**：$\iota_1: K \to K \sqcup L$ 和 $\iota_2: L \to K \sqcup L$ 分别为将 $K$、$L$ 的顶点嵌入到无交并中。

**泛性质交换图**：
$$
\begin{CD}
K @>{\iota_1}>> K \sqcup L @<{\iota_2}<< L \\
@V{g_1}VV @AA{\exists! g}A @VV{g_2}V \\
Y @= Y @= Y
\end{CD}
$$

**直观理解**：余积是"同时包含 $K$ 和 $L$ 的信息"的最小对象，通过嵌入可以"注入"任一因子的信息。
</blockquote>

<blockquote class="example">

推出是余积的推广。它不仅将两个复形组合在一起，还要求它们沿着一个公共子复形"粘贴"。这种粘贴关系使得推出能够捕捉"共享结构"，这正是BPE算法中"连续子串约束"的数学本质。

**核心构造2：推出（Pushout）**

给定态射 $f: M \to K$、$g: M \to L$，**推出** $K \sqcup_M L$ 是满足 $\iota_1 \circ f = \iota_2 \circ g$ 的余极限对象。

**核心交换方块**：
$$
\begin{CD}
M @>{f}>> K \\
@V{g}VV @VV{\iota_1}V \\
L @>>{\iota_2}> K \sqcup_M L
\end{CD}
$$

**推出的具体构造**：
1. **顶点集**：$V_{K \sqcup_M L} = (V_K \sqcup V_L)/\sim$（无交并模等价关系：对任意 $v \in V_M$，$f(v) \sim g(v)$，即 $M$ 中顶点的像在 $K$ 和 $L$ 中被"粘合"）；
2. **单纯形族**：$\sigma \in K \sqcup_M L$ 当且仅当 $\sigma$ 的代表元集是 $K$ 或 $L$ 中的单纯形（在等价关系下保持单纯形结构）。

**直观理解**：推出是"在约束 $M$ 下，$K$ 和 $L$ 的最小公共超结构"——将 $K$ 和 $L$ 沿着 $M$ 的像"粘贴"在一起。

**推出的交换图**（使用LaTeX CD环境）：
$$
\begin{CD}
M @>{f}>> K \\
@V{g}VV @VV{\iota_1}V \\
L @>>{\iota_2}> K \sqcup_M L
\end{CD}
$$
</blockquote>

</blockquote>
<blockquote class="subsection">

### 函数芽：余极限的一个直观例子

函数芽是数学分析中的一个经典概念，它为我们提供了理解余极限的直观例子。函数芽通过"局部粘贴为整体"的方式构造，这与BPE算法中"原子粘贴为Token"的逻辑完全一致。通过这个例子，我们可以看到余极限并非抽象的范畴构造，而是有着深刻的几何和代数内涵。
  <blockquote class="definition">

设 $X$ 为拓扑空间，$x_0 \in X$，考虑所有在 $x_0$ 的某个邻域内有定义的连续函数构成的集合 $$\mathcal{F} = \{ f: U \to \mathbb{R} \mid U \text{ 是 } x_0 \text{ 的邻域}, f \text{ 连续} \}$$定义等价关系 $\sim$：$f \sim g$ 当且仅当存在 $x_0$ 的邻域 $V \subseteq \text{dom}(f) \cap \text{dom}(g)$，使得 $f|_V = g|_V$（即 $f$ 与 $g$ 在 $x_0$ 附近局部相等）。
函数芽（Germ of Functions） $[f]_{x_0}$ 是 $f$ 关于 $\sim$ 的等价类，
核心是“函数在某点附近的局部行为等价类”。
</blockquote>
<blockquote class="example">

**函数芽的余极限构造**
将函数芽的生成过程转化为复形范畴的余极限，直观体现“局部粘贴为整体”的核心逻辑：

构造图表 $\mathcal{D}$：
- 指标范畴 $\mathcal{I}$：对象为 $x_0$ 的所有邻域 $U$，态射为邻域的包含关系 $U \to V$（若 $V \subseteq U$）；
- 图表赋值：对每个邻域 $U$，定义复形 $K_U = F(\text{dom}(f|_U))$（自由复形，顶点为函数定义域的点，单纯形为局部交互关系）；
- 态射赋值：对包含关系 $U \to V$，定义单纯映射 $f_{UV}: K_U \to K_V$ 为自由函子延拓的包含映射（保留局部结构）。
1. 余极限对象：
   图表 $\mathcal{D}$ 的余极限 $\lim_{\rightarrow} K_U$ 即为“函数芽复形”——其顶点集为所有局部定义域的无交并模“局部相等”等价关系，单纯形族为局部单纯形的粘贴结果，对应函数芽 $[f]_{x_0}$ 的局部行为抽象。

**余极限泛性质的体现**：
任意“全局连续函数对应的复形” $L$，若存在局部态射族 $$\{ g_U: K_U \to L \}$$，则存在唯一态射 $$g: \lim_{\rightarrow} K_U \to L,$$即“局部行为唯一确定全局等价类”，与函数芽的定义完全契合。
</blockquote>

<blockquote class="remark">

函数芽与BPE的共性
1. 局部→整体：函数芽是“局部函数粘贴为全局等价类”，BPE是“局部原子粘贴为全局Token”，均为余极限的“粘贴”逻辑；
2. 等价关系核心：函数芽的“局部相等”等价关系，对应BPE的“连续子串约束”（推出构造中的等价关系 $f(v) \sim g(v)$）；
3. 直观性：函数芽是余极限最贴近直觉的实例，帮助理解BPE的余极限本质——并非抽象的范畴构造，而是“局部约束下的全局聚合”。
</blockquote>
  
</blockquote>
</blockquote>

　　极限与余极限为我们提供了构造复形的方法，但要在不同的范畴之间建立联系，我们需要引入函子的概念。函子不仅可以将复形映射到其他结构，更重要的是，通过伴随对的概念，我们可以理解BPE中"自由生成"与"结构遗忘"之间的对偶关系。

<blockquote class="chapter">

# 函子与伴随对
<blockquote class="section">

## 遗忘函子（Forgetful Functor）

函子是范畴之间的映射，它保持了范畴的结构。遗忘函子是一个特殊的函子，它"忘记"了复形的结构，只保留了顶点集。这种"遗忘"操作看似简单，但它为我们提供了理解"结构"与"载体"之间关系的重要工具。

<blockquote class="definition">

遗忘函子的定义
复形范畴到集合范畴的遗忘函子 $$U: \mathbf{Comp} \to \mathbf{Set}$$，核心是“忘掉附加结构，保留核心载体”：
1. 对象层面：对任意单纯复形 $K \in \text{Ob}(\mathbf{Comp})$，$U(K) = V_K$（仅保留复形的顶点集，舍弃单纯形族、维度、方向等结构信息）；
2. 态射层面：对任意单纯映射 $f: K \to L \in \text{Hom}(\mathbf{Comp})$，$U(f) = f|_{V_K}: V_K \to V_L$（仅保留顶点集上的基础映射，忘掉“保持单纯形结构”的约束）。

遗忘函子的核心性质：
- 忠实性（Faithful）：若 $U(f) = U(g)$，则 $f = g$（复形间的单纯映射由顶点映射唯一确定）；
- 不-full性：并非所有集合映射都能被提升为单纯映射（需满足“保持单纯形”约束）。
</blockquote>
</blockquote>

<blockquote class="section">

## 自由函子（Free Functor）

自由函子是遗忘函子的左伴随。如果说遗忘函子是"剥离结构"，那么自由函子就是"装配结构"。它从最简单的集合出发，为其"装配"最小的复形结构，使得这个复形包含了集合的所有信息，同时不包含任何多余的结构。

<blockquote class="definition">

自由函子的定义
集合范畴到复形范畴的自由函子 $F: \mathbf{Set} \to \mathbf{Comp}$，是遗忘函子的左伴随，核心是“从基础载体生成最小附加结构”：
1. 对象层面：对任意集合 $S \in \text{Ob}(\mathbf{Set})$，$F(S)$ 为“自由单纯复形”——其单纯形族是 $S$ 的所有有限子集（自动满足单纯复形的三点公理），即：
$$
F(S) = \{ \sigma \mid \sigma \subseteq S, \sigma \text{ 有限} \}
$$
2. 态射层面：对任意集合映射 $h: S \to T \in \text{Hom}(\mathbf{Set})$，$F(h): F(S) \to F(T)$ 为自然延拓的单纯映射，满足 $F(h)(\sigma) = \{ h(v) \mid v \in \sigma \}$（自动保持单纯形结构）。
</blockquote>

<blockquote class="property">

伴随函子对的核心关系
遗忘函子 $U$ 与自由函子 $F$ 构成伴随对 $(F \dashv U)$，即对任意集合 $S \in \mathbf{Set}$、复形 $K \in \mathbf{Comp}$，存在自然同构：
$$
\text{Hom}_{\mathbf{Comp}}(F(S), K) \cong \text{Hom}_{\mathbf{Set}}(S, U(K))
$$
直观含义：“从自由复形到任意复形的单纯映射”，等价于“从集合到复形顶点集的基础映射”——自由函子为集合“装配”最小复形结构，遗忘函子则“剥离”结构还原为集合。
</blockquote>

<blockquote class="example">

自由函子在BPE中的应用
BPE的“预设原子表”本质是自由函子的输出：
设 $S$ 为预设原子集合（如字符集 $\{a, b, c, ...\}$），则 $F(S)$ 为“原子复形”（0维复形，仅含单点单纯形）；
BPE的初始词表对应 $U(F(S)) = S$（遗忘函子提取顶点集），后续聚合过程则是在自由复形基础上通过余极限（推出）生成高维单纯形（高维Token）。
</blockquote>
</blockquote>
</blockquote>




<blockquote class="chapter">

# 应用：BPE的复形诠释与逆向分裂的探索



<blockquote class="section">

## BPE作为余极限过程

BPE（Byte Pair Encoding）是自然语言处理中广泛使用的词表构建算法。从范畴论的视角来看，BPE的本质是在原复形中通过余极限操作将原子聚合为Token。这种理解不仅揭示了BPE的数学本质，更为我们设计新的词表构建算法提供了理论指导。

<blockquote class="definition">

**BPE的原复形结构**

正向BPE的整个过程均在**原复形** $K$ 中进行，其结构对应关系如下：
1. **初始状态**：预设原子表对应 $K$ 的0维单纯形（顶点），即 $V_K = S$（原子集合），$K_0 = \{\{v\} \mid v \in V_K\}$（0维单纯形族）；
2. 聚合过程：通过余极限（推出）构造，将满足“连续子串约束”的低维单纯形（原子/低维Token）粘贴为高维单纯形（高维Token），即 $K_d$（$d=1,2,3$）为不同维度的Token集合；
3. 最终状态：完整BPE词表对应 $K$ 的全体1~3维单纯形族，词表规模随高维单纯形的生成而增大（基元→整体）；
4. 核心特征：$K$ 的顶点是“原子”，单纯形是“原子组合的Token”，结构为“原子→Token”（顶点→单纯形）。
</blockquote>
</blockquote>

　　BPE算法通过余极限将原子聚合为Token。我们探索是否存在一个对偶的算法——逆向分裂——能够通过极限将全局交互模式分解为极小原子簇。如果这样的算法存在，它在数学结构上应与BPE对偶：BPE在原复形中进行，而逆向分裂应在共轭复形中进行，它们通过"顶点-单纯形反转"形成自然的对偶关系。

<blockquote class="section">

## 逆向分裂作为极限过程：一个开放性问题

我们探索是否存在一个与BPE对偶的算法——逆向分裂。如果说BPE是通过余极限"聚合"原子为Token，那么逆向分裂（如果存在）应该通过极限"分解"全局交互模式为极小原子簇。这种对偶关系不仅应体现在算法结构上，更应体现在它们所操作的复形上：BPE在原复形中进行，而逆向分裂应在共轭复形中进行。**注意**：逆向分裂是否存在、如何实现，仍是一个开放性问题。

<blockquote class="example">

逆向分裂的理论设计：共轭复形结构
如果逆向分裂算法存在，其过程应在共轭复形 $K^*$ 中进行，其与共轭复形的理论对应关系应为：
1. 初始状态：输入的“物品编号+交互序列”对应 $K^*$ 的0维单纯形（顶点），即 $V_{K^*} = \{ \sigma \mid \sigma \in K \}$（原复形的Token作为共轭复形的顶点）；
2. 拆解过程：通过极限（拉回）构造，将满足“频率+极小性约束”的高维单纯形（全局交互模式）分解为低维单纯形（极小原子簇），即 $K^*_d$（$d=1,2,3$）为不同维度的原子簇集合；
3. 最终状态：全局极小原子簇对应 $K^*$ 的全体1~3维单纯形族，词表规模随高维单纯形的分解而减小（整体→基元）；
4. 核心特征：$K^*$ 的顶点是“原复形的Token”，单纯形是“Token分解的原子簇”，结构为“Token→原子簇”（顶点→单纯形），与原复形的“原子→Token”完全反转。
</blockquote>
</blockquote>

　　BPE在原复形中进行，而如果逆向分裂存在，它应在共轭复形中进行。这种结构上的对偶性不仅应体现在它们使用的数学工具（余极限与极限）上，更应体现在它们所操作的复形结构上。共轭复形通过"顶点-单纯形反转"提供了这种对偶关系的理论框架，使得两种算法在数学上可能形成完美的对称。

<blockquote class="section">

## 共轭复形关系的核心体现
<blockquote class="property">

BPE与潜在逆向分裂的对偶等价性
正向BPE（原复形 $K$）与潜在逆向分裂（共轭复形 $K^*$）的共轭关系，本质是范畴论对偶性的理论探索：
1. 结构对偶：
   - 原复形 $K$：顶点=原子，单纯形=Token（基元→整体的聚合结构）；
   - 共轭复形 $K^*$：顶点=Token，单纯形=原子簇（整体→基元的分解结构）；
   - 反转关系：$K$ 的单纯形是 $K^*$ 的顶点，$K$ 的顶点是 $K^*$ 单纯形的“极小覆盖单元”。
2. 构造对偶（理论预期）：
   - BPE：余极限（推出+余积），粘贴低维单纯形生成高维单纯形；
   - 逆向分裂（如果存在）：极限（拉回+积），分解高维单纯形得到低维单纯形；
   - 共轭适配：$(K \text{ 的余极限})^* = K^* \text{ 的极限}$（聚合结果的共轭=分解的起点）。
3. 性能对偶（理论预期）：
   - $K$ 中BPE：记忆潜力↑（高维Token含更多局部信息），泛化潜力↓（依赖原子预设）；
   - $K^*$ 中逆向分裂（如果存在）：泛化潜力↑（原子簇是公共子结构），记忆潜力↓（极小覆盖无冗余）。
</blockquote>

<blockquote class="section">

## 正向BPE：原子复形的余极限聚合

<blockquote class="definition">

原子复形
BPE的“预设原子表”对应复形范畴的基础对象——原子复形 $A$：
1. 原子复形 $A$ 为0维复形（仅含单点单纯形），顶点集 $V_A$ 为预设原子（如字符、子词）；
2. 交互序列中的连续子串对应“原子间的连接关系”，可生成1~3维单纯形（有向边、三角形、四面体），构成辅助复形 $M$（约束复形）。
</blockquote>

<blockquote class="example">

BPE聚合的余极限实现
BPE的核心是“原子→高维Token”的聚合，本质是复形范畴的推出构造：
1. 给定原子复形 $A_1, A_2$（两个待聚合的原子），约束复形 $M$（连续子串约束，仅允许≤4长度连续原子组合）；
2. 态射 $f: M \to A_1$、$g: M \to A_2$ 为“约束适配映射”（标记满足连续条件的原子对）；
3. 推出 $A_1 \sqcup_M A_2$ 即为聚合后的高维Token复形，对应BPE的merge操作。

实际工程中，BPE的迭代聚合可视为一系列推出的复合：
$$
\lim_{\rightarrow} (A_1 \sqcup_M A_2) \sqcup_{M'} A_3 \sqcup \dots
$$
其中 $M'$ 为后续聚合的约束复形（更新后的连续子串规则），最终余极限为完整的BPE词表复形。

![BPE的推出构造过程：超图逐步聚合](images/figure2_bpe_pushout.png)
</blockquote>

<blockquote class="remark">

BPE的范畴论特征
1. 词表从小到大：余积→推出的余极限构造，本质是“基元粘贴为整体”，词表规模随聚合过程递增；
2. 记忆潜力提升：高维Token复形包含更多交互信息，减少对单个原子的依赖，记忆效率提升；
3. 泛化潜力受限：依赖预设原子表（原子复形的顶点集固定），对未见过的原子组合泛化能力较弱。
</blockquote>

</blockquote>

<blockquote class="section">

## 逆向分裂作为极限过程：理论设计框架

<blockquote class="definition">

逆向分裂的交互复形定义
逆向分裂的输入是“物品编号+交互序列”，对应交互复形 $G$：
1. 交互复形 $G$ 为1~3维有向单纯复形，顶点集 $V_G$ 为物品编号，单纯形为交互序列中提取的公共子结构（按频率筛选，频率≥阈值的单纯形保留）；
2. 核心目标是从 $G$ 中拆解出“不可拆分的极小原子簇”，即交互复形的极限对象。
</blockquote>

<blockquote class="example">

逆向分裂的极限实现
逆向分裂的核心是“整体→基元”的分解，本质是复形范畴的拉回构造：
1. 给定全局交互复形 $G$，约束复形 $M$（频率约束+极小性约束，仅保留不可被更小簇替代的单纯形）；
2. 态射 $f: G_1 \to M$、$g: G_2 \to M$ 为“约束筛选映射”（标记满足频率和极小性的子复形）；
3. 拉回 $G_1 \times_M G_2$ 即为拆解出的极小原子簇复形，对应逆向分裂的理论输出。

理论上，逆向分裂的分布式拆解可视为一系列拉回的复合：
$$
\lim_{\leftarrow} (G_1 \times_M G_2) \times_{M'} G_3 \times \dots
$$
其中 $M'$ 为后续拆解的约束复形（更新后的频率和极小性规则），最终极限为全局极小原子簇集合。

![逆向分裂的拉回构造过程：超图逐步分解（理论设计）](images/figure3_inverse_splitting_pullback.png)
</blockquote>

<blockquote class="remark">

逆向分裂的理论特征（如果算法存在）
1. 词表从大到小：积→拉回的极限构造，本质是“整体分解为基元”，词表规模随拆解过程递减；
2. 泛化潜力提升：无预设原子表（交互复形的顶点集为物品编号，无固定基元），极小原子簇为“公共子结构”，对未见过的物品组合泛化能力较强；
3. 记忆潜力可控：通过低维截断（仅1~3维）和稀疏存储（仅保留高频单纯形），极限对象的规模可控，记忆负担较轻。
</blockquote>

</blockquote>

　　共轭复形关系揭示了BPE与潜在逆向分裂在结构上的对偶性，但更深入的对偶关系应体现在它们的性能特征上。BPE通过聚合提升记忆效率，但泛化能力受限；如果逆向分裂存在，它应通过分解提升泛化能力，但记忆效率可控。这种性能上的对偶性正是共轭结构在算法设计中的理论预期。

<blockquote class="section">

## 对偶关系

<blockquote class="property">

**BPE与潜在逆向分裂的对偶性**

正向BPE（原复形 $K$）与潜在逆向分裂（共轭复形 $K^*$）的共轭关系，本质是范畴论对偶性的理论探索：

1. **结构对偶**（理论预期）：
   - 原复形 $K$：顶点=原子，单纯形=Token（基元→整体的聚合结构）；
   - 共轭复形 $K^*$：顶点=Token，单纯形=原子簇（整体→基元的分解结构）；
   - 反转关系：$K$ 的单纯形是 $K^*$ 的顶点，$K$ 的顶点是 $K^*$ 单纯形的"极小覆盖单元"。

2. **构造对偶**（理论预期）：
   - BPE：余极限（推出+余积），粘贴低维单纯形生成高维单纯形；
   - 逆向分裂（如果存在）：极限（拉回+积），分解高维单纯形得到低维单纯形；
   - 共轭适配：$(K \text{ 的余极限})^* = K^* \text{ 的极限}$（聚合结果的共轭=分解的起点）。

3. **性能对偶**（理论预期）：
   - $K$ 中BPE：记忆潜力↑（高维Token含更多局部信息），泛化潜力↓（依赖原子预设）；
   - $K^*$ 中逆向分裂（如果存在）：泛化潜力↑（原子簇是公共子结构），记忆潜力↓（极小覆盖无冗余）。

**注意**：逆向分裂是否存在、如何实现，仍是一个开放性问题。这里的对偶关系是理论上的探索。
</blockquote>

</blockquote>

　　理论上的对偶关系为我们提供了理解算法的框架，但要将这些理论应用于实际工程，我们还需要考虑计算复杂度、存储效率、分布式实现等实际问题。范畴论的泛性质不仅保证了算法的正确性，更为工程实现提供了优化方向。

<blockquote class="section">

## 工程实现

<blockquote class="discussion">

工程化适配的范畴论启发
1. 约束复形的设计：BPE的推出约束 $M$（连续子串长度）、逆向分裂的拉回约束 $M$（频率+极小性），本质是通过“态射的约束条件”筛选泛对象，避免冗余计算；
2. 低维截断的合理性：复形范畴中1~3维单纯形的构造和态射计算复杂度低，且能覆盖绝大多数交互模式，是“理论严谨性”与“工程可行性”的平衡；
3. 分布式实现：极限/余极限的“图表分解”特性，适配MapReduce架构（各分片对应子图表，最终聚合为全局极限/余极限），支持亿级物品规模。
</blockquote>

<blockquote class="discussion">

共轭复形关系的工程意义（理论预期）
1. 数据互通：原复形的Token数据可直接作为共轭复形的顶点数据，无需额外预处理，如果逆向分裂存在，可实现BPE与逆向分裂的无缝衔接；
2. 约束复用：原复形的“连续子串约束”（推出中的 $M$）与共轭复形的“频率约束”（拉回中的 $M$）是共轭约束，可通过对偶变换相互推导，减少约束设计成本；
3. 效率匹配：$K$ 与 $K^*$ 的维度一致（1~3维），计算复杂度同级，如果逆向分裂存在，其工程实现效率应与BPE相当（均为 $O(M \log M)$）；
4. 泛化互补：共轭结构使BPE的“记忆优势”与逆向分裂的“泛化优势”形成互补，可通过“原复形-共轭复形”切换，适配不同场景需求。
</blockquote>

</blockquote>
</blockquote>


# 总结

1. 基础理论：复形范畴 $\mathbf{Comp}$ 以单纯复形为对象、单纯映射为态射，是完备且余完备的范畴，极限（积+拉回）与余极限（余积+推出）是核心构造；
2. 实例映射：BPE是“原子复形的余极限聚合”，逆向分裂是“交互复形的极限分解”，二者为范畴论对偶操作；
3. 工程价值：范畴论的泛性质保证了操作的合理性，极限/余极限的构造为工程化实现（约束设计、低维截断、分布式并行）提供了严格的理论支撑。



### 补充总结
1. 函子层面：遗忘函子与自由函子构成伴随对，为BPE的原子复形生成提供理论基础，体现“结构装配-剥离”的对偶逻辑；
2. 余极限实例：函数芽直观诠释了“局部粘贴为整体”的余极限本质，与BPE的聚合逻辑同源；
3. 核心对偶：正向BPE位于原复形 $K$，逆向分裂位于共轭复形 $K^*$，二者通过“顶点-单纯形反转”形成共轭关系，既保持理论严谨性，又为工程化互补提供了拓扑基础。